(()=>{var e={594:(e,t,i)=>{"use strict";function n(e){var t;t=e.idwServicesConf.idwDataAccountWebUrl,window.open(t,"_blank").focus()}i.r(t),i.d(t,{app:()=>K});var r=i(900),s=i(750),o=i(13);class a{constructor(){var e;(e="tcDataValue")in this?Object.defineProperty(this,e,{value:null,enumerable:!0,configurable:!0,writable:!0}):this[e]=null}hasConsent(){try{if(r.GJ.overrideHasConsent)return!0;if(!window.__tcfapi&&r.GJ.softPrivacyRegulated)return!0;if(!this.tcDataValue)return o.u.warn("Not yet received TCData from TCF API addEventListener"),!1;if(!1===this.tcDataValue.gdprApplies)return!0;const e=!!this.tcDataValue?.vendor?.consents[1116];return o.u.debug("Anonymised IAB vendor (ID 1116) consent:",e),e}catch(e){return o.u.error(e),!1}}onConsentChanged(e){window.__tcfapi?window.__tcfapi("addEventListener",2,((t,i)=>{"cmpuishown"===t.eventStatus&&this.tcDataValue||(i?(o.u.debug(`tcf event: ${t.eventStatus}`,t),this.tcDataValue=t,e()):o.u.error("__tcfapi.addEventListener failed with error. tcData: ",t))})):r.GJ.overrideHasConsent||r.GJ.softPrivacyRegulated?e():o.u.error("__tcfapi is not defined")}}class c extends a{displayCMP(){window.__tcfapi("displayConsentUi",2,(()=>{}))}}class l extends a{displayCMP(){if(window.__cmp)try{window.__cmp("showScreen")}catch(e){o.u.error("Consentmanager API error:",e)}else o.u.warn("Consentmanager API(window.__cmp) is not availale. Can not invoke showScreen")}}class d extends a{displayCMP(){window.__tcfapi("toggleConsentTool",2,(()=>{}))}}class u extends a{displayCMP(){if(window.__lxG__consent__&&window.__lxG__consent__.showConsent)try{window.__lxG__consent__.showConsent()}catch(e){o.u.error("Clickio API error:",e)}else o.u.warn("Clickio API(window.__lxG__consent__) is not availale. Can not invoke displayCMP")}}class g extends a{constructor(e){var t;super(),(t="privacyManagerId")in this?Object.defineProperty(this,t,{value:null,enumerable:!0,configurable:!0,writable:!0}):this[t]=null,this.privacyManagerId=e}displayCMP(){const e=window._sp_?.gdpr?.loadPrivacyManagerModal||window._sp_?.loadPrivacyManagerModal;if(e)try{this.privacyManagerId?e(this.privacyManagerId):e()}catch(e){o.u.error("Sourcepoint API error:",e)}else o.u.warn("Sourcepoint API error: loadPrivacyManagerModal() function is not defined")}}class h extends a{displayCMP(){if(window.__unicapi)try{window.__unicapi("openunic")}catch(e){o.u.error("UniConsent API error:",e)}else o.u.warn("UniConsent API(window.__unicapi) is not available")}}class p extends a{displayCMP(){if(window.Cookiebot&&window.Cookiebot.show)try{window.Cookiebot.show()}catch(e){o.u.error("Cookiebot API error:",e)}else o.u.warn("Cookiebot API(window.Cookiebot) is not availale. Can not invoke displayCMP")}}class w extends a{displayCMP(){o.u.warn(`attempt to call displayCMP. This should not happened when ${s.Pu.cmpProvider} attribute is not set`)}}function f(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class _ extends a{constructor(e){super(),f(this,"cookieGroup",null),f(this,"useTcfApi",!0),this.cookieGroup=e?.trim(),this.useTcfApi=!this.cookieGroup}displayCMP(){if(window._iub&&window._iub.cs&&window._iub.cs.api&&window._iub.cs.api.openPreferences)try{window._iub.cs.api.openPreferences()}catch(e){o.u.error("Iubenda API error:",e)}else o.u.warn("Iubenda API(window._iub.cs.api.openPreferences()) is not availale. Can not invoke function")}hasConsent(){return this.useTcfApi?super.hasConsent():window._iub?.cs?.consent?.purposes[this.cookieGroup]}onConsentChanged(e){if(this.useTcfApi)super.onConsentChanged(e);else{let t=this.hasConsent();window._iub?setInterval((()=>{const i=this.hasConsent();t!==i&&(t=i,e())}),1e3):o.u.warn("Iubenda API(window._iub) is not availale"),e()}}}function m(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class y extends a{constructor(e){super(),m(this,"cookieGroup",null),m(this,"useTcfApi",!0),this.cookieGroup=e?.trim(),this.useTcfApi=!this.cookieGroup}displayCMP(){if(window.OneTrust&&window.OneTrust.ToggleInfoDisplay)try{window.OneTrust.ToggleInfoDisplay()}catch(e){o.u.error("OneTrust API error:",e)}else o.u.warn("OneTrust API(window.OneTrust.ToggleInfoDisplay) is not availale. Can not invoke ToggleInfoDisplay")}hasConsent(){return this.useTcfApi?super.hasConsent():window.OptanonActiveGroups&&window.OptanonActiveGroups.toLocaleLowerCase().includes(this.cookieGroup.toLocaleLowerCase())}onConsentChanged(e){this.useTcfApi?super.onConsentChanged(e):(window.OneTrust&&window.OneTrust.OnConsentChanged?window.OneTrust.OnConsentChanged((function(){e()})):o.u.warn("OneTrust API(window.OneTrust.OnConsentChanged) is not availale. Can not invoke OnConsentChanged"),e())}}class v extends a{displayCMP(){if(window.googlefc&&window.googlefc.showRevocationMessage)try{window.googlefc.showRevocationMessage()}catch(e){o.u.error("Google Funding Choices API error:",e)}else o.u.warn("Google Funding Choices API is not available. Can not invoke googlefc.showRevocationMessage()")}}let S=null;const[b,k]=r.GJ.cmpProvider?r.GJ.cmpProvider.split(":"):["undefined",null],C=k?.trim()||null,I=r.GJ.cmpProviderCookieGroup;switch(b.toLowerCase()){case s.y$.Quantcast:o.u.debug("using QuantcastApi"),S=new c;break;case s.y$.Consentmanager:o.u.debug("using ConsentmanagerApi"),S=new l;break;case s.y$.Liveramp:o.u.debug("using LiverampApi"),S=new d;break;case s.y$.Clickio:o.u.debug("using ClickioApi"),S=new u;break;case s.y$.Sourcepoint:o.u.debug("using SourcepointApi"),S=new g(C);break;case s.y$.Iubenda:o.u.debug("using Iubenda"),S=new _(I);break;case s.y$.Uniconsent:o.u.debug("using UniConsentApi"),S=new h;break;case s.y$.OneTrust:case s.y$.CookiePro:o.u.debug("using OneTrustApi"),S=new y(I);break;case s.y$.CookieBot:o.u.debug("using Cookiebot"),S=new p;break;case s.y$.Googlefc:o.u.debug("using GooglefcApi"),S=new v;break;default:o.u.info(`Unset or used incorrect value of the ${s.Pu.cmpProvider}:'${r.GJ.cmpProvider}'. \n        The default TCFv2 API will be used`),S=new w}class T{constructor(e,t){this.pluginConfig=e,this.hydraOrch=t}addPluginToDOM(){const e=document.createDocumentFragment(),t=document.createElement("div");t.innerHTML="<div id='idw_plugin_container'>\n        <div id='idward-plugin-buttons'>\n        </div>\n      </div>",e.appendChild(t.firstChild),document.body.appendChild(e)}navigateToScreenLoggedInMain(){document.getElementById("idward-plugin-buttons").innerHTML="<button class='pluginBtn' id='idw-manage-consent' \n          style='display: block; border-bottom: 1px solid black'>Manage Your Data</button>\n          <button class='pluginBtn' id='idw-cookies-setting' \n          style=\"display: block\">Cookie Settings</button>",document.getElementById("idw-cookies-setting").onclick=()=>{S.displayCMP(),z.closePlugin()},document.getElementById("idw-manage-consent").onclick=()=>{n(this.pluginConfig),z.closePlugin()},z.closeIframeOnClickOutside()}}function x(e,t={}){return new Promise((i=>{if(function(e){return!!document.querySelector(`script[src='${e}']`)}(e))return void i();const n=document.createElement("script");n.type="text/javascript",n.addEventListener("load",(()=>{i()})),n.src=e,Object.keys(t).forEach((e=>{n.setAttribute(e,t[e])})),document.getElementsByTagName("head")[0].appendChild(n)}))}function P(e){const t=document.querySelector(`script[src='${e}']`);t&&t.parentNode.removeChild(t)}function E(){const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.split(/[:\/]/g).pop().toLowerCase()}const R=async function(e){await x(e.idwServicesConf.idwTimemeScript),e.retargetingOn&&await x(e.idwServicesConf.idwRetargetingScript,{idw_authority:e.hydraConf.authority,[s.Pu.retargetingSegmentsUrl]:e.idwServicesConf.idwRetargetingSegmentsUrl,idw_metrics_url:`${e.idwServicesConf.idwMetricsRootUrl}/v3/collect/tag`}),function(){const t=setInterval((function(){if(void 0!==window.TimeMe){const i=E();sessionStorage.setItem("idw-pageview-id",i),x(e.idwServicesConf.idwCollectorScript,{idw_authority:e.hydraConf.authority,idw_client_id:e.clientId,idw_metrics_url:e.idwServicesConf.idwMetricsCollector}),clearInterval(t)}}),250)}()},O=function(e){void 0!==window.IdwCollect&&window.IdwCollect.stopCollect(),void 0!==window.AnonInterestScores&&window.AnonInterestScores.stopCollect(),P(e.idwServicesConf.idwCollectorScript),P(e.idwServicesConf.idwTimemeScript),P(e.idwServicesConf.idwRetargetingScript)};var U=i(970);const A=new(i(517).O)(r.GJ),L="idw-impressions";async function M(e,t){const i={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+t},body:JSON.stringify(e)};o.u.debug("Sending impression to server",e);try{return(await fetch(`${r.GJ.idwServicesConf.idwMetricsRootUrl}/v3/collect/impression`,i)).ok}catch(e){o.u.warn("Sending impression failed ",e)}}const j="freq-cap-";let N;async function q(e){if("idw-impression-tracker"===e.data?.from){if(!N||!await N())return void o.u.debug("frequency capping is disabled due to lack of CMP consent");o.u.debug("impression-tracker message received",e.data,"from",e.origin);const t=/^([a-zA-Z0-9]{1,100}):([a-zA-Z0-9x.,]{1,100}):([a-zA-Z0-9,]{1,100})$/g;if(e.data.freqCapping&&t.test(e.data.freqCapping)){const[t,i,n]=e.data.freqCapping.split(":"),r=`${j}${t}`,o=i.split(","),a=n.split(","),c=function(e,t,i){const n=Date.now(),r=JSON.parse(localStorage.getItem(e))||{};return t.forEach((e=>{const[t,i]=e.split("x"),s=60*parseFloat(i)*60*1e3;let o=r[e]?.calls||0,a=r[e]?.lastCall||n;n-a<s?o+=1:o=1,a=n,r[e]={calls:o,lastCall:a}})),r.cohortIds=i,localStorage.setItem(e,JSON.stringify(r)),r}(r,o,a);$(c,o)&&function(e){const t=(JSON.parse(localStorage.getItem(s.dR.IdwCohortIdsKey))??[]).filter((t=>!e.includes(t)));localStorage.setItem(s.dR.IdwCohortIdsKey,JSON.stringify(t))}(a)}else o.u.warn("invalid format of impcounter message: ",e.data?.freqCapping);e.data?.src&&async function(e){let t=null;try{t=new URL(e)}catch(e){return void o.u.warn("impression-tracker recieved impcounter src is not a valid URL")}const i=t.searchParams,n=i.get("campaignId"),r=i.get("creativeId"),s=i.get("publisherId");if(n&&r&&s){const e={campaign_id:n,creative_id:r,publisher_id:s};await async function(e){const t=await A.getUser(),i=JSON.parse(localStorage.getItem(L))??{};if(i[`${e.campaign_id}-${e.creative_id}-${e.publisher_id}`]=e,t)for(const e of Object.keys(i)){const n=i[e];await M(n,t.access_token)&&delete i[e]}else o.u.warn("No sub. Impression cached, will be sent later");localStorage.setItem(L,JSON.stringify(i))}(e)}else o.u.warn("impression-tracker required src query param(s) are missing")}(e.data.src)}}function $(e,t,i=Date.now()){return t.reduce(((t,n)=>{const[r,s]=n.split("x"),o=parseInt(r),a=60*parseFloat(s)*60*1e3;return t.push({calls:e[n]?.calls||0,lastCall:e[n]?.lastCall||i,count:o,period:a}),t}),[]).some((({lastCall:e,calls:t,period:n,count:r})=>i-e<n&&t>=r))}async function H(){let e=JSON.parse(localStorage.getItem(s.dR.IdwCohortIdsKey))??[];const t=JSON.parse(localStorage.getItem(s.dR.IdwCohortIdsLastUpdate))??0;if((0===e.length||Date.now()-t>1e3*r.GJ.cohortPollingInterval*60*60)&&(e=await async function(){const e={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+(await A.getUser()).access_token}};try{const t=await fetch(r.GJ.idwServicesConf.idwUserSegmentsUrl,e);return 401===t.status&&A.queueLogin(),t.ok?await t.json():null}catch(e){return o.u.error("Failed to fetch cohort IDs:",e),null}}(),o.u.debug("fetched cohorts: ",e),e)){const t=(i=e,function(){try{return Object.entries(localStorage).filter((e=>e[0].startsWith(j))).map((e=>JSON.parse(e[1])))}catch(e){return o.u.error(e),[]}}().forEach((e=>{$(e,Object.keys(e).filter((e=>"cohortIds"!==e)))&&(i=i.filter((t=>!e.cohortIds.includes(t))))})),i);localStorage.setItem(s.dR.IdwCohortIdsKey,JSON.stringify(t)),localStorage.setItem(s.dR.IdwCohortIdsLastUpdate,JSON.stringify(Date.now()))}var i}function B(e,t,i){let n;n=e<3?e/30:e<30?e/32:e/105;let r=.1;return t/i<.1?r=0:t/i<.25?r=.05:t/i<.5&&(r=.075),n+r}function J(){const e=document.documentElement,t=document.body,i="scrollTop",n="scrollHeight";return(e[i]||t[i])/((e[n]||t[n])-e.clientHeight)*100||0}const G={maxScrollPosition:0,getMaxScroll:function(){return Math.round(this.maxScrollPosition)},updateMaxScroll:function(){const e=J();e>this.maxScrollPosition&&(this.maxScrollPosition=e)},subscribeToScrollEvent:function(){window.addEventListener("scroll",(()=>{this.updateMaxScroll()}))}};function F(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}G.subscribeToScrollEvent();const D="idw-intscores",W=new class{constructor(e){F(this,"isPageScoreStored",!1),F(this,"pluginConfig",void 0),this.pluginConfig=e}getCookie(e){const t=`; ${document.cookie}`.split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()}setCookie(e,t,i){const n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);const r=`expires=${n.toUTCString()}`;document.cookie=`${e}=${t};${r};path=/`}getOrCreateFeId(){const e="idw-fe-id";let t=localStorage.getItem(e);return t||(t=this.getCookie(e),t?localStorage.setItem(e,t):(t=E(),localStorage.setItem(e,t),this.setCookie(e,t,365))),t}async start(){document.addEventListener("visibilitychange",this.visibilitychangeHandler.bind(this)),this.sendAccumulatedInterestScores(),localStorage.removeItem(s.dR.IdwCohortIdsRealTimeKey),Object.entries(localStorage).filter((([e,t])=>e.startsWith("idw-intscore-"))).forEach((([e,t])=>{localStorage.removeItem(e)}))}stop(){document.removeEventListener("visibilitychange",this.visibilitychangeHandler.bind(this))}visibilitychangeHandler(){"hidden"!==document.visibilityState||this.isPageScoreStored||this.calculateAndStoreInterestScores()}calculateAndStoreInterestScores(e=!0){const t={value:B(window.TimeMe?window.TimeMe.getTimeOnCurrentPageInSeconds()??0:(console.log("Interest scores: TimeMe is undefined"),0),Math.round(J()),G.getMaxScroll()),url:encodeURIComponent(window.location.href)},i=localStorage.getItem(D)?JSON.parse(localStorage.getItem(D)):[];i.push(t);try{const t=this.aggregateByUrlKey(i);return localStorage.setItem(D,JSON.stringify(t)),this.isPageScoreStored=e,t}catch(e){o.u.error("Failed to aggregate interest scores:",e)}}async sendAccumulatedInterestScores(){const e=localStorage.getItem(D)?JSON.parse(localStorage.getItem(D)):this.calculateAndStoreInterestScores(!1);if(e&&e.length>0){const t=await A.getUser(),i=t&&!t.expired,n=i?`${this.pluginConfig.idwServicesConf.idwMetricsRootUrl}/v3/interest-scores`:`${this.pluginConfig.idwServicesConf.idwMetricsRootUrl}/v3/anon/interest-scores`,r={scores:e,fe_id:this.getOrCreateFeId()},a={method:"POST",headers:i?{"Content-Type":"application/json",Authorization:"Bearer "+t.access_token}:{"Content-Type":"application/json"},body:JSON.stringify(r)};try{const e=await fetch(n,a),i=e.ok?await e.json():[];i.push("default"),t&&localStorage.removeItem(D);const r=JSON.parse(localStorage.getItem(s.dR.IdwCohortIdsKey))??[],o=new Set([...r,...i]);localStorage.setItem(s.dR.IdwCohortIdsKey,JSON.stringify(Array.from(o)))}catch(e){o.u.error("Failed to send interest scores:",e)}}}aggregateByUrlKey(e){const t=e.reduce(((e,t)=>{const{url:i,value:n}=t;return"number"==typeof n&&(e.hasOwnProperty(i)?e[i]+=n:e[i]=n),e}),{});return Object.keys(t).map((e=>({url:e,value:t[e]})))}}(r.GJ);class z{constructor(e,t){this.loaded=!1,this.hydraOrch=e,this.pluginConfig=t,this.screenProvider=new T(this.pluginConfig,e)}async build(){var e;this.injectCustomCSSOverrides(),this.screenProvider.addPluginToDOM(),this.addIdwButtonToDOM(),await this.buildUserSpecificUI(),this.subscribeToCmpEvents(),e=S.hasConsent.bind(S),N=e,window.addEventListener("message",q)}subscribeToCmpEvents(){S.onConsentChanged((async()=>{const e=await this.hydraOrch.getUser(),t=S.hasConsent();o.u.info(`CMP consent set to ${t}`),null===e&&t&&this.hydraOrch.queueLogin(),e&&t&&await H(),t||this.loaded||(async function(){const e={method:"GET",headers:{"Content-Type":"application/json"}};try{await fetch(`${r.GJ.idwServicesConf.idwMetricsCollector}`,e)}catch(e){o.u.error("metrics collector api ping error:",e)}}(),this.loaded=!0),this.handleCollectScripts(t)}))}async handleCollectScripts(e){e?(W.start(),R(this.pluginConfig)):(O(this.pluginConfig),W.stop())}async buildUserSpecificUI(){if(U.s.get(s.dR.IdwHydraHasErrorKey))return function(e,t=r.GJ.idwServicesConf.idwMetricsCollector){const i=JSON.stringify({metrics_type:e,time_spent:0,scroll:0,max_scroll:0,scroll_height:document.documentElement.scrollHeight,url:encodeURIComponent(window.location.href),urlref:encodeURIComponent(document.referrer),urldes:encodeURIComponent(document.activeElement.href),acc_uuid:"new_unknown_user",start_time:Date.now(),date:Date.now()});navigator.sendBeacon(t,i)}("PLUGIN_OFFLINE"),void this.screenProvider.navigateToScreenLoggedInMain();null===await this.hydraOrch.getUser()?z.shouldHideIdwTrigger(!0):(this.screenProvider.navigateToScreenLoggedInMain(),z.shouldHideIdwTrigger(this.pluginConfig.hideIdwButton),await async function(){if(null!==localStorage.getItem(s.dR.IdwBoundEmail)||!window.idwTryGetEmail)return;const e=window.idwTryGetEmail();if(e)try{const t=await async function(e){const t=await A.getUser(),i={method:"POST",body:JSON.stringify({email:e}),headers:{"Content-Type":"application/json",Authorization:"Bearer "+t.access_token}},n=await fetch(`${r.GJ.idwServicesConf.idwEmailBinderUrl}`,i);if(!n.ok)throw n.status;return{email:e}}(e);localStorage.setItem(s.dR.IdwBoundEmail,t.email)}catch(e){o.u.error("Failed to POST binded email: ",e)}}())}addIdwButtonToDOM(){if(this.pluginConfig.hideIdwButton)return;const e=document.createDocumentFragment(),t=document.createElement("div");t.innerHTML=`<div id='idward-open-trigger'\n        style='display:none' ${this.pluginConfig.notIntegrateCmp?"title='Click to manage your data'":"title=''"}>\n        <img src="https://storage.googleapis.com/idw_static_assets/anonymized_small_black.png" loading="lazy" alt="Anonymised">\n      </div>`,e.appendChild(t.firstChild),document.body.appendChild(document.adoptNode(e)),document.getElementById("idward-open-trigger").addEventListener("click",this.handleOpenTriggerClick.bind(this),!1)}handleOpenTriggerClick(){this.pluginConfig.notIntegrateCmp||S instanceof w||this.pluginConfig.softPrivacyRegulated&&!window.__tcfapi?n(this.pluginConfig):this.togglePlugin()}togglePlugin(){document.getElementById("idw_plugin_container").classList.contains("idw-open")?"hidden"!==document.body.style.overflow&&z.closePlugin():z.reopenPlugin()}static closeIframeOnClickOutside(){document.addEventListener("click",(function(e){const t=document.getElementById("idward-open-trigger"),i=t?.contains(e.target);i||z.closePlugin()}))}static shouldHideIdwTrigger(e){const t=document.getElementById("idward-open-trigger");t&&t.style&&(t.style.display=e?"none":"block")}static closePlugin(){document.getElementById("idw_plugin_container").classList.remove("idw-open")}static reopenPlugin(){document.getElementById("idw_plugin_container").classList.add("idw-open")}addStyle(e){const t=document.createElement("style");t.textContent=e,document.head.appendChild(t)}injectCustomCSSOverrides(){this.addStyle(`\n      #idw_plugin_container .pluginBtn {\n            color: ${this.pluginConfig.colourPrimary} !important;\n        }\n\n        #idw_plugin_container .pluginBtn:hover {\n            background-color: ${this.pluginConfig.colourPrimary} !important;\n        }\n                \n        #idward-open-trigger {\n            background-color: ${this.pluginConfig.colourPrimary};\n        }\n    `)}}function K(){o.u.info("start Anonymised Marketing Tag"),new z(A,r.GJ).build().then((()=>{const e="idw-prebid-last-check",t=localStorage.getItem(e);if(!t||Date.now()-t>12096e5){const t=document.createElement("script");t.src=r.GJ.idwServicesConf.idwBidderCheckerScript,t.type="text/javascript",t.async=!0,t.onload=()=>{localStorage.setItem(e,Date.now())},document.body.appendChild(t)}})).catch((e=>{o.u.error(`Error during bidder checker script loading ${r.GJ.idwServicesConf.idwBidderCheckerScript}: ${e}`)}))}},859:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n="0.3.9"},823:(e,t,i)=>{"use strict";var n=i(900);async function r(){return"loading"!==document.readyState}var s=i(13);async function o(){return new Promise((e=>{n.GJ.overrideHasConsent||n.GJ.softPrivacyRegulated?(s.u.debug("Consider TCF API ready because of overrideHasConsent or softPrivacyRegulated is true"),e(!0)):window.__tcfapi?window.__tcfapi("ping",2,(t=>{e("loaded"===t.cmpStatus)})):e(!1)}))}async function a(){return new Promise((e=>{e(window.OneTrust||window.Optanon)}))}async function c(){return new Promise((e=>{e(!!window._iub?.cs?.consent?.purposes)}))}async function l(){return!["football365.com","planetf1.com","planetfootball.com","teamtalk.com","cricket365.com","tennis365.com","loverugbyleague.com","casahitech.it","rintraccialamiaspedizione.it","cucina-naturale.it"].some((e=>location.host.indexOf(e)>-1))}var d=i(970),u=i(750),g=i(517),h=i(984),p=i(859);async function w(e,t,i=100){async function n(e){return new Promise((t=>{setTimeout((()=>{t(!0)}),e)}))}let r=0,s=await e();for(;!s&&r<=i;)await n(100),s=await e(),r++;if(!s)throw t}if(window.location.search.includes("hydra-error")||window.location.search.includes("error=")){const e="PROD"===n.GJ.type?600:20,t=window.localStorage.getItem("idw-signin-from")??"/";d.s.set(u.dR.IdwHydraHasErrorKey,!0,e),window.history.replaceState({},"",t)}!async function(){if(window.location.search.includes("callback=in")){await(0,g.z)();const e=window.localStorage.getItem("idw-signin-from")??"/";s.u.debug(`replacing url back to ${e}`),window.history.replaceState({},"",e);const t=window.sessionStorage.getItem(u.dR.idwScrollY);t&&(window.scrollTo(0,Number(t)),window.sessionStorage.removeItem(u.dR.idwScrollY))}if(window._anonymised_tag={version:p.Z,getConfig:()=>({...n.GJ})},s.u.setDefaultLevel(n.GJ.type),window.self!==window.top)return void s.u.warn("Anonymised tag will not start. Not running in the top frame");if([...Array.from(document.querySelectorAll('script[src*="static.anonymised.io/light/bundle"]')),...Array.from(document.querySelectorAll('script[src*="idward-cmp-v2-dev/light/bundle"]')),...Array.from(document.querySelectorAll('script[src*="localhost:3000/bundle.js"]'))].length>1)return void s.u.warn("Another instance of the Anonymised tag script already running on the page! Stop rendering this instance");if(function(){try{const e=/bot\\b|index|spider|crawl|wget|slurp|Mediapartners-Google/i;return-1!==navigator.userAgent.search(e)}catch{return!1}}())return void s.u.warn("Anonymised tag will not start. Bot detected on site");if(window.location.protocol.startsWith("file:"))return void s.u.warn("Anonymised tag will not start. Running on file protocol");const e=await Promise.all([l(),(0,h.c)(),(0,n.QZ)()]);if(e[0])if(e[1])try{await Promise.all([w(r,"waiting for DOM to be ready",80),!!n.GJ.cmpProviderCookieGroup||w(o,"waiting for TCF API to be ready",140),!(n.GJ.cmpProvider&&n.GJ.cmpProvider.includes(u.y$.OneTrust))||w(a,"waiting for OneTrust API to be ready",80),!(n.GJ.cmpProvider&&n.GJ.cmpProvider.includes(u.y$.Iubenda))||w(c,"waiting for Iubenda API to be ready",80)]),Promise.resolve().then(i.bind(i,594)).then((({app:e})=>{e()}))}catch(e){s.u.error("Anonymised tag will not start because because of the timeout while",e)}else s.u.warn(`Anonymised tag will not start. The domain '${window.location.hostname}' is not verified by the Anonymised team`);else s.u.warn(`Anonymised tag will not start. Disabled on the '${window.location.hostname}' domain`)}()},984:(e,t,i)=>{"use strict";i.d(t,{c:()=>r});var n=i(900);async function r(){const e={method:"GET",headers:{"Content-Type":"application/json"}};try{const{ok:t}=await fetch(`${n.GJ.idwServicesConf.idwHealthCheckUrl}`,e);return t}catch(e){return!1}}},900:(e,t,i)=>{"use strict";i.d(t,{QZ:()=>y,GJ:()=>m});var n=i(274),r=i(859);const s="https://aegis.dev.anonymised.io",o="https://aegis.dev.anonymised.io",a={type:"DEV",hydraConf:{authority:s,client_id:window.location.origin,redirect_uri:(0,n.f)(window.location.href,{callback:"in"}),response_type:"code",scope:"token profile id_token",metadata:{issuer:s,authorization_endpoint:`${s}/oauth2/auth`,userinfo_endpoint:`${s}/userinfo`,token_endpoint:`${o}/oauth2/token`},accessTokenExpiringNotificationTimeInSeconds:600},idwServicesConf:{idwMetricsRootUrl:"https://material.dev.anonymised.io",idwMetricsCollector:"https://material.dev.anonymised.io/metrics/collect",idwEmailBinderUrl:"https://material.dev.anonymised.io/link",idwCollectorScript:`https://storage.googleapis.com/idward-cmp-v2-dev/light/collect.min.js?v=${r.Z}`,idwRetargetingScript:"https://storage.googleapis.com/idward-cmp-v2-dev/light/retargeting.js",idwBidderCheckerScript:`https://storage.googleapis.com/idward-cmp-v2-dev/light/bidderchecker.js?v=${r.Z}`,idwTimemeScript:"https://cdnjs.cloudflare.com/ajax/libs/TimeMe.js/2.0.0/timeme.min.js",idwDataAccountWebUrl:"https://data-account-web-lwvpr3pb6a-ew.a.run.app",idwUserSegmentsUrl:"https://user-segments-lwvpr3pb6a-ew.a.run.app/segments",idwRetargetingSegmentsUrl:"https://user-segments-lwvpr3pb6a-ew.a.run.app/retargeting",idwHealthCheckUrl:`${o}/health`},notIntegrateCmp:!1,overrideHasConsent:!1,softPrivacyRegulated:!1,hideIdwButton:!1,notLoginUser:!1,retargetingOn:!1,extendLoginToSubdomains:!1,cohortPollingInterval:1},c="https://account.anonymised.io/login",l="https://aegis.anonymised.io",d={type:"PROD",hydraConf:{authority:c,client_id:window.location.origin,redirect_uri:(0,n.f)(window.location.href,{callback:"in"}),response_type:"code",scope:"token profile id_token",metadata:{issuer:c,authorization_endpoint:`${c}/oauth2/auth`,userinfo_endpoint:`${c}/userinfo`,token_endpoint:`${l}/oauth2/token`},accessTokenExpiringNotificationTimeInSeconds:259200},idwServicesConf:{idwMetricsRootUrl:"https://material.anonymised.io",idwMetricsCollector:"https://material.anonymised.io/metrics/collect",idwEmailBinderUrl:"https://material.anonymised.io/link",idwCollectorScript:`https://static.anonymised.io/light/collect.min.js?v=${r.Z}`,idwRetargetingScript:"https://static.anonymised.io/light/retargeting.js",idwBidderCheckerScript:`https://static.anonymised.io/light/bidderchecker.js?v=${r.Z}`,idwTimemeScript:"https://cdnjs.cloudflare.com/ajax/libs/TimeMe.js/2.0.0/timeme.min.js",idwDataAccountWebUrl:"https://account.anonymised.io",idwUserSegmentsUrl:"https://user-segments.anonymised.io/segments",idwRetargetingSegmentsUrl:"https://user-segments.anonymised.io/retargeting",idwHealthCheckUrl:`${l}/health`},notIntegrateCmp:!1,overrideHasConsent:!1,softPrivacyRegulated:!1,hideIdwButton:!1,notLoginUser:!1,retargetingOn:!1,extendLoginToSubdomains:!1,cohortPollingInterval:12};var u=i(13),g=i(750);async function h(e){const t={method:"GET",headers:{"Content-Type":"application/json"}};try{const i="DEV"===e?"https://material.dev.anonymised.io/v3/tag/configs":"https://material.anonymised.io/v3/tag/configs",n=await fetch(i,t);return{config:await n.json(),isTagVerified:!0}}catch(e){let t=!0;return e.toString().includes("TypeError")&&(t=!1),{isTagVerified:t,config:{}}}}function p(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function w(e,t){try{return e.replace(/[[\] '"]/g,"").split(",")}catch{return void u.u.warn(`Error parsing '${t}' setting value ${e}`)}}const f=document.currentScript,_=new class{constructor(e,t=h,i=window.localStorage,n=window.sessionStorage){p(this,"pluginConfig",void 0),p(this,"scriptElement",void 0),p(this,"localStorage",void 0),p(this,"sessionStorage",void 0),p(this,"remoteConfigPromise",void 0),p(this,"attributeConfig",void 0),p(this,"localStorageConfig",void 0),p(this,"sessionStorageConfig",void 0),this.scriptElement=e,this.localStorage=i,this.sessionStorage=n,this.attributeConfig=this.getAttributeConfig(),this.localStorageConfig=this.getLocalStorageConfig(),this.sessionStorageConfig=this.getSessionStorageConfig();const r=this.mergeConfigs(this.attributeConfig,this.localStorageConfig,this.sessionStorageConfig),s="dev"===r.environment?"DEV":"PROD";this.remoteConfigPromise=t(s),this.pluginConfig=this.mapAttributeConfigToConfig(r),this.initRemoteConfig()}async initRemoteConfig(){const{config:e}=await this.remoteConfigPromise,t=this.mergeConfigs(this.attributeConfig,this.localStorageConfig,e,this.sessionStorageConfig);this.pluginConfig=this.mapAttributeConfigToConfig(t)}getAttributeConfig(){const e={};return Object.entries(g.Pu).forEach((([t,i])=>{const n=this.scriptElement.getAttribute(i);n&&(e[t]=n)})),e}getLocalStorageConfig(){const e={};return Object.entries(g.Pu).forEach((([t,i])=>{const n=this.localStorage.getItem(i);n&&(e[t]=n)})),e}getSessionStorageConfig(){const e={};return Object.entries(g.Pu).forEach((([t,i])=>{const n=this.sessionStorage.getItem(i);n&&(e[t]=n)})),e}mergeConfigs(...e){return Object.assign({},...e)}async isTagVerified(){const{isTagVerified:e}=await this.remoteConfigPromise;return e}mapAttributeConfigToConfig(e){const t="dev"===e.environment?a:d;return e.colourPrimary&&(t.colourPrimary=e.colourPrimary),e.cmpProvider&&(t.cmpProvider=e.cmpProvider),e.cmpProviderCookieGroup&&(t.cmpProviderCookieGroup=e.cmpProviderCookieGroup),e.clientId&&(t.clientId=e.clientId),e.notIntegrateCmp&&(t.notIntegrateCmp="true"===e.notIntegrateCmp),e.overrideHasConsent&&(t.overrideHasConsent="true"===e.overrideHasConsent),e.softPrivacyRegulated&&(t.softPrivacyRegulated="true"===e.softPrivacyRegulated),e.hideIdwButton&&(t.hideIdwButton="true"===e.hideIdwButton),e.notLoginUser&&(t.notLoginUser="true"===e.notLoginUser),e.retargetingOn&&(t.retargetingOn="true"===e.retargetingOn),e.extendLoginToSubdomains&&(t.extendLoginToSubdomains="true"===e.extendLoginToSubdomains),e.cohortPollingInterval&&(t.cohortPollingInterval=e.cohortPollingInterval),e.loginExceptionPages&&(t.loginExceptionPages=w(e.loginExceptionPages,g.Pu.loginExceptionPages)),e.loginInclusionPages&&(t.loginInclusionPages=w(e.loginInclusionPages,g.Pu.loginInclusionPages)),e.immediateLoginPages&&(t.immediateLoginPages=w(e.immediateLoginPages,g.Pu.immediateLoginPages)),e.metricsCollector&&(t.idwServicesConf.idwMetricsCollector=e.metricsCollector),e.metricsRootUrl&&(t.idwServicesConf.idwMetricsRootUrl=e.metricsRootUrl),e.collectorScript&&(t.idwServicesConf.idwCollectorScript=e.collectorScript),e.retargetingScript&&(t.idwServicesConf.idwRetargetingScript=e.retargetingScript),e.bidderCheckerScript&&(t.idwServicesConf.idwBidderCheckerScript=e.bidderCheckerScript),e.timemeScript&&(t.idwServicesConf.idwTimemeScript=e.timemeScript),e.dataAccountWebUrl&&(t.idwServicesConf.idwDataAccountWebUrl=e.dataAccountWebUrl),e.userSegmentsUrl&&(t.idwServicesConf.idwUserSegmentsUrl=e.userSegmentsUrl),e.retargetingSegmentsUrl&&(t.idwServicesConf.idwRetargetingSegmentsUrl=e.retargetingSegmentsUrl),e.healthCheckUrl&&(t.idwServicesConf.idwHealthCheckUrl=e.healthCheckUrl),e.emailBinderUrl&&(t.idwServicesConf.idwEmailBinderUrl=e.emailBinderUrl),e.authority&&(t.hydraConf={...t.hydraConf,authority:e.authority,metadata:{...t.hydraConf.metadata,issuer:e.authority,authorization_endpoint:`${e.authority}/oauth2/auth`,userinfo_endpoint:`${e.authority}/userinfo`}}),t}}(f),m=_.pluginConfig,y=_.isTagVerified.bind(_)},750:(e,t,i)=>{"use strict";let n,r,s;i.d(t,{Pu:()=>s,dR:()=>n,y$:()=>r}),function(e){e.IdwHydraHasErrorKey="IDW_HYDRA_HAS_ERROR",e.IdwBoundEmail="IDW_BOUND_EMAIL",e.IdwCohortIdsKey="cohort_ids",e.IdwCohortIdsLastUpdate="cohort_ids_ts",e.IdwCohortIdsRealTimeKey="cohort_ids_real_time",e.idwScrollY="idw-scroll-y"}(n||(n={})),function(e){e.Quantcast="quantcast",e.Consentmanager="consentmanager",e.Liveramp="liveramp",e.Clickio="clickio",e.Sourcepoint="sourcepoint",e.Iubenda="iubenda",e.Uniconsent="uniconsent",e.OneTrust="onetrust",e.CookiePro="cookiepro",e.CookieBot="cookiebot",e.Googlefc="googlefc"}(r||(r={})),function(e){e.colourPrimary="idw_color_primary",e.cmpProvider="idw_cmp_provider",e.cmpProviderCookieGroup="idw_cmp_provider_cookie_group",e.environment="idw_environment",e.notIntegrateCmp="idw_not_integrate_cmp",e.overrideHasConsent="override_has_consent",e.softPrivacyRegulated="soft_privacy_regulated",e.hideIdwButton="idw_hide_button",e.notLoginUser="not_login_user",e.retargetingOn="retargeting_on",e.extendLoginToSubdomains="extend_login_to_subdomains",e.clientId="idw_client_id",e.cohortPollingInterval="idw_cohort_polling_interval",e.loginExceptionPages="idw_login_exception_pages",e.loginInclusionPages="idw_login_inclusion_pages",e.immediateLoginPages="idw_immediate_login_pages",e.metricsRootUrl="idw_metrics_root_url",e.metricsCollector="idw_metrics_collector_url",e.collectorScript="idw_collector_script_url",e.retargetingScript="idw_retargeting_script_url",e.timemeScript="idw_timeme_script_url",e.userSegmentsUrl="idw_user_segments_url",e.retargetingSegmentsUrl="idw_retargeting_segments_url",e.healthCheckUrl="idw_health_check_url",e.emailBinderUrl="idw_email_binder_url",e.authority="idw_authority"}(s||(s={}))},517:(e,t,i)=>{"use strict";i.d(t,{O:()=>de,z:()=>ge});var n=i(249),r=i(153),s=i(269),o=i(743);function a(e){this.message=e}a.prototype=new Error,a.prototype.name="InvalidCharacterError";var c="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new a("'atob' failed: The string to be decoded is not correctly encoded.");for(var i,n,r=0,s=0,o="";n=t.charAt(s++);~n&&(i=r%4?64*i+n:n,r++%4)?o+=String.fromCharCode(255&i>>(-2*r&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return o};function l(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(c(e).replace(/(.)/g,(function(e,t){var i=t.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i})))}(t)}catch(e){return c(t)}}function d(e){this.message=e}d.prototype=new Error,d.prototype.name="InvalidTokenError";const u=function(e,t){if("string"!=typeof e)throw new d("Invalid token specified");var i=!0===(t=t||{}).header?0:1;try{return JSON.parse(l(e.split(".")[i]))}catch(e){throw new d("Invalid token specified: "+e.message)}};var g,h,p,w={debug:()=>{},info:()=>{},warn:()=>{},error:()=>{}},f=(e=>(e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR",e[e.WARN=2]="WARN",e[e.INFO=3]="INFO",e[e.DEBUG=4]="DEBUG",e))(f||{});(p=f||(f={})).reset=function(){g=3,h=w},p.setLevel=function(e){if(!(0<=e&&e<=4))throw new Error("Invalid log level");g=e},p.setLogger=function(e){h=e};var _=class{constructor(e){this._name=e}debug(...e){g>=4&&h.debug(_._format(this._name,this._method),...e)}info(...e){g>=3&&h.info(_._format(this._name,this._method),...e)}warn(...e){g>=2&&h.warn(_._format(this._name,this._method),...e)}error(...e){g>=1&&h.error(_._format(this._name,this._method),...e)}throw(e){throw this.error(e),e}create(e){const t=Object.create(this);return t._method=e,t.debug("begin"),t}static createStatic(e,t){const i=new _(`${e}.${t}`);return i.debug("begin"),i}static _format(e,t){const i=`[${e}]`;return t?`${i} ${t}:`:i}static debug(e,...t){g>=4&&h.debug(_._format(e),...t)}static info(e,...t){g>=3&&h.info(_._format(e),...t)}static warn(e,...t){g>=2&&h.warn(_._format(e),...t)}static error(e,...t){g>=1&&h.error(_._format(e),...t)}};f.reset();var m=class{static _randomWord(){return n.lib.WordArray.random(1).words[0]}static generateUUIDv4(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>(+e^m._randomWord()&15>>+e/4).toString(16))).replace(/-/g,"")}static generateCodeVerifier(){return m.generateUUIDv4()+m.generateUUIDv4()+m.generateUUIDv4()}static generateCodeChallenge(e){try{const t=r(e);return s.stringify(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}catch(e){throw _.error("CryptoUtils.generateCodeChallenge",e),e}}static generateBasicAuth(e,t){const i=o.parse([e,t].join(":"));return s.stringify(i)}},y=class{constructor(e){this._name=e,this._logger=new _(`Event('${this._name}')`),this._callbacks=[]}addHandler(e){return this._callbacks.push(e),()=>this.removeHandler(e)}removeHandler(e){const t=this._callbacks.lastIndexOf(e);t>=0&&this._callbacks.splice(t,1)}raise(...e){this._logger.debug("raise:",...e);for(const t of this._callbacks)t(...e)}},v=class{static decode(e){try{return u(e)}catch(e){throw _.error("JwtUtils.decode",e),e}}},S=class{static center({...e}){var t;return null==e.width&&(e.width=null!=(t=[800,720,600,480].find((e=>e<=window.outerWidth/1.618)))?t:360),null!=e.left||(e.left=Math.max(0,Math.round(window.screenX+(window.outerWidth-e.width)/2))),null!=e.height&&(null!=e.top||(e.top=Math.max(0,Math.round(window.screenY+(window.outerHeight-e.height)/2)))),e}static serialize(e){return Object.entries(e).filter((([,e])=>null!=e)).map((([e,t])=>`${e}=${"boolean"!=typeof t?t:t?"yes":"no"}`)).join(",")}},b=class extends y{constructor(){super(...arguments),this._logger=new _(`Timer('${this._name}')`),this._timerHandle=null,this._expiration=0,this._callback=()=>{const e=this._expiration-b.getEpochTime();this._logger.debug("timer completes in",e),this._expiration<=b.getEpochTime()&&(this.cancel(),super.raise())}}static getEpochTime(){return Math.floor(Date.now()/1e3)}init(e){const t=this._logger.create("init");e=Math.max(Math.floor(e),1);const i=b.getEpochTime()+e;if(this.expiration===i&&this._timerHandle)return void t.debug("skipping since already initialized for expiration at",this.expiration);this.cancel(),t.debug("using duration",e),this._expiration=i;const n=Math.min(e,5);this._timerHandle=setInterval(this._callback,1e3*n)}get expiration(){return this._expiration}cancel(){this._logger.create("cancel"),this._timerHandle&&(clearInterval(this._timerHandle),this._timerHandle=null)}},k=class{static readParams(e,t="query"){if(!e)throw new TypeError("Invalid URL");const i=new URL(e,window.location.origin)["fragment"===t?"hash":"search"];return new URLSearchParams(i.slice(1))}},C=class extends Error{constructor(e,t){var i,n,r;if(super(e.error_description||e.error||""),this.form=t,this.name="ErrorResponse",!e.error)throw _.error("ErrorResponse","No error passed"),new Error("No error passed");this.error=e.error,this.error_description=null!=(i=e.error_description)?i:null,this.error_uri=null!=(n=e.error_uri)?n:null,this.state=e.userState,this.session_state=null!=(r=e.session_state)?r:null}},I=class extends Error{constructor(e){super(e),this.name="ErrorTimeout"}},T=class{constructor(e){this._logger=new _("AccessTokenEvents"),this._expiringTimer=new b("Access token expiring"),this._expiredTimer=new b("Access token expired"),this._expiringNotificationTimeInSeconds=e.expiringNotificationTimeInSeconds}load(e){const t=this._logger.create("load");if(e.access_token&&void 0!==e.expires_in){const i=e.expires_in;if(t.debug("access token present, remaining duration:",i),i>0){let e=i-this._expiringNotificationTimeInSeconds;e<=0&&(e=1),t.debug("registering expiring timer, raising in",e,"seconds"),this._expiringTimer.init(e)}else t.debug("canceling existing expiring timer because we're past expiration."),this._expiringTimer.cancel();const n=i+1;t.debug("registering expired timer, raising in",n,"seconds"),this._expiredTimer.init(n)}else this._expiringTimer.cancel(),this._expiredTimer.cancel()}unload(){this._logger.debug("unload: canceling existing access token timers"),this._expiringTimer.cancel(),this._expiredTimer.cancel()}addAccessTokenExpiring(e){return this._expiringTimer.addHandler(e)}removeAccessTokenExpiring(e){this._expiringTimer.removeHandler(e)}addAccessTokenExpired(e){return this._expiredTimer.addHandler(e)}removeAccessTokenExpired(e){this._expiredTimer.removeHandler(e)}},x=class{constructor(){this._logger=new _("InMemoryWebStorage"),this._data={}}clear(){this._logger.create("clear"),this._data={}}getItem(e){return this._logger.create(`getItem('${e}')`),this._data[e]}setItem(e,t){this._logger.create(`setItem('${e}')`),this._data[e]=t}removeItem(e){this._logger.create(`removeItem('${e}')`),delete this._data[e]}get length(){return Object.getOwnPropertyNames(this._data).length}key(e){return Object.getOwnPropertyNames(this._data)[e]}},P=class{constructor(e=[],t=null){this._jwtHandler=t,this._logger=new _("JsonService"),this._contentTypes=[],this._contentTypes.push(...e,"application/json"),t&&this._contentTypes.push("application/jwt")}async fetchWithTimeout(e,t={}){const{timeoutInSeconds:i,...n}=t;if(!i)return await fetch(e,n);const r=new AbortController,s=setTimeout((()=>r.abort()),1e3*i);try{return await fetch(e,{...t,signal:r.signal})}catch(e){if(e instanceof DOMException&&"AbortError"===e.name)throw new I("Network timed out");throw e}finally{clearTimeout(s)}}async getJson(e,{token:t,credentials:i}={}){const n=this._logger.create("getJson"),r={Accept:this._contentTypes.join(", ")};let s;t&&(n.debug("token passed, setting Authorization header"),r.Authorization="Bearer "+t);try{n.debug("url:",e),s=await this.fetchWithTimeout(e,{method:"GET",headers:r,credentials:i})}catch(e){throw n.error("Network Error"),e}n.debug("HTTP response received, status",s.status);const o=s.headers.get("Content-Type");if(o&&!this._contentTypes.find((e=>o.startsWith(e)))&&n.throw(new Error(`Invalid response Content-Type: ${null!=o?o:"undefined"}, from URL: ${e}`)),s.ok&&this._jwtHandler&&(null==o?void 0:o.startsWith("application/jwt")))return await this._jwtHandler(await s.text());let a;try{a=await s.json()}catch(e){if(n.error("Error parsing JSON response",e),s.ok)throw e;throw new Error(`${s.statusText} (${s.status})`)}if(!s.ok){if(n.error("Error from server:",a),a.error)throw new C(a);throw new Error(`${s.statusText} (${s.status}): ${JSON.stringify(a)}`)}return a}async postForm(e,{body:t,basicAuth:i,timeoutInSeconds:n,initCredentials:r}){const s=this._logger.create("postForm"),o={Accept:this._contentTypes.join(", "),"Content-Type":"application/x-www-form-urlencoded"};let a;void 0!==i&&(o.Authorization="Basic "+i);try{s.debug("url:",e),a=await this.fetchWithTimeout(e,{method:"POST",headers:o,body:t,timeoutInSeconds:n,credentials:r})}catch(e){throw s.error("Network error"),e}s.debug("HTTP response received, status",a.status);const c=a.headers.get("Content-Type");if(c&&!this._contentTypes.find((e=>c.startsWith(e))))throw new Error(`Invalid response Content-Type: ${null!=c?c:"undefined"}, from URL: ${e}`);const l=await a.text();let d={};if(l)try{d=JSON.parse(l)}catch(e){if(s.error("Error parsing JSON response",e),a.ok)throw e;throw new Error(`${a.statusText} (${a.status})`)}if(!a.ok){if(s.error("Error from server:",d),d.error)throw new C(d,t);throw new Error(`${a.statusText} (${a.status}): ${JSON.stringify(d)}`)}return d}},E=class{constructor({prefix:e="oidc.",store:t=localStorage}={}){this._logger=new _("WebStorageStateStore"),this._store=t,this._prefix=e}async set(e,t){this._logger.create(`set('${e}')`),e=this._prefix+e,await this._store.setItem(e,t)}async get(e){return this._logger.create(`get('${e}')`),e=this._prefix+e,await this._store.getItem(e)}async remove(e){this._logger.create(`remove('${e}')`),e=this._prefix+e;const t=await this._store.getItem(e);return await this._store.removeItem(e),t}async getAllKeys(){this._logger.create("getAllKeys");const e=await this._store.length,t=[];for(let i=0;i<e;i++){const e=await this._store.key(i);e&&0===e.indexOf(this._prefix)&&t.push(e.substr(this._prefix.length))}return t}},R=class{constructor({authority:e,metadataUrl:t,metadata:i,signingKeys:n,metadataSeed:r,client_id:s,client_secret:o,response_type:a="code",scope:c="openid",redirect_uri:l,post_logout_redirect_uri:d,client_authentication:u="client_secret_post",prompt:g,display:h,max_age:p,ui_locales:w,acr_values:f,resource:_,response_mode:m="query",filterProtocolClaims:y=!0,loadUserInfo:v=!1,staleStateAgeInSeconds:S=900,clockSkewInSeconds:b=300,userInfoJwtIssuer:k="OP",mergeClaims:C=!1,disablePKCE:I=!1,stateStore:T,refreshTokenCredentials:P,revokeTokenAdditionalContentTypes:R,fetchRequestCredentials:O,refreshTokenAllowedScope:U,extraQueryParams:A={},extraTokenParams:L={}}){if(this.authority=e,t?this.metadataUrl=t:(this.metadataUrl=e,e&&(this.metadataUrl.endsWith("/")||(this.metadataUrl+="/"),this.metadataUrl+=".well-known/openid-configuration")),this.metadata=i,this.metadataSeed=r,this.signingKeys=n,this.client_id=s,this.client_secret=o,this.response_type=a,this.scope=c,this.redirect_uri=l,this.post_logout_redirect_uri=d,this.client_authentication=u,this.prompt=g,this.display=h,this.max_age=p,this.ui_locales=w,this.acr_values=f,this.resource=_,this.response_mode=m,this.filterProtocolClaims=null==y||y,this.loadUserInfo=!!v,this.staleStateAgeInSeconds=S,this.clockSkewInSeconds=b,this.userInfoJwtIssuer=k,this.mergeClaims=!!C,this.disablePKCE=!!I,this.revokeTokenAdditionalContentTypes=R,O&&P&&console.warn("Both fetchRequestCredentials and refreshTokenCredentials is set. Only fetchRequestCredentials will be used."),this.fetchRequestCredentials=O||P||"same-origin",T)this.stateStore=T;else{const e="undefined"!=typeof window?window.localStorage:new x;this.stateStore=new E({store:e})}this.refreshTokenAllowedScope=U,this.extraQueryParams=A,this.extraTokenParams=L}},O=class{constructor(e,t){this._settings=e,this._metadataService=t,this._logger=new _("TokenClient"),this._jsonService=new P(this._settings.revokeTokenAdditionalContentTypes)}async exchangeCode({grant_type:e="authorization_code",redirect_uri:t=this._settings.redirect_uri,client_id:i=this._settings.client_id,client_secret:n=this._settings.client_secret,...r}){const s=this._logger.create("exchangeCode");i||s.throw(new Error("A client_id is required")),t||s.throw(new Error("A redirect_uri is required")),r.code||s.throw(new Error("A code is required"));const o=new URLSearchParams({grant_type:e,redirect_uri:t});for(const[e,t]of Object.entries(r))null!=t&&o.set(e,t);let a;switch(this._settings.client_authentication){case"client_secret_basic":if(!n)throw s.throw(new Error("A client_secret is required")),null;a=m.generateBasicAuth(i,n);break;case"client_secret_post":o.append("client_id",i),n&&o.append("client_secret",n)}const c=await this._metadataService.getTokenEndpoint(!1);s.debug("got token endpoint");const l=await this._jsonService.postForm(c,{body:o,basicAuth:a,initCredentials:this._settings.fetchRequestCredentials});return s.debug("got response"),l}async exchangeCredentials({grant_type:e="password",client_id:t=this._settings.client_id,client_secret:i=this._settings.client_secret,scope:n=this._settings.scope,...r}){const s=this._logger.create("exchangeCredentials");t||s.throw(new Error("A client_id is required"));const o=new URLSearchParams({grant_type:e,scope:n});for(const[e,t]of Object.entries(r))null!=t&&o.set(e,t);let a;switch(this._settings.client_authentication){case"client_secret_basic":if(!i)throw s.throw(new Error("A client_secret is required")),null;a=m.generateBasicAuth(t,i);break;case"client_secret_post":o.append("client_id",t),i&&o.append("client_secret",i)}const c=await this._metadataService.getTokenEndpoint(!1);s.debug("got token endpoint");const l=await this._jsonService.postForm(c,{body:o,basicAuth:a,initCredentials:this._settings.fetchRequestCredentials});return s.debug("got response"),l}async exchangeRefreshToken({grant_type:e="refresh_token",client_id:t=this._settings.client_id,client_secret:i=this._settings.client_secret,timeoutInSeconds:n,...r}){const s=this._logger.create("exchangeRefreshToken");t||s.throw(new Error("A client_id is required")),r.refresh_token||s.throw(new Error("A refresh_token is required"));const o=new URLSearchParams({grant_type:e});for(const[e,t]of Object.entries(r))null!=t&&o.set(e,t);let a;switch(this._settings.client_authentication){case"client_secret_basic":if(!i)throw s.throw(new Error("A client_secret is required")),null;a=m.generateBasicAuth(t,i);break;case"client_secret_post":o.append("client_id",t),i&&o.append("client_secret",i)}const c=await this._metadataService.getTokenEndpoint(!1);s.debug("got token endpoint");const l=await this._jsonService.postForm(c,{body:o,basicAuth:a,timeoutInSeconds:n,initCredentials:this._settings.fetchRequestCredentials});return s.debug("got response"),l}async revoke(e){var t;const i=this._logger.create("revoke");e.token||i.throw(new Error("A token is required"));const n=await this._metadataService.getRevocationEndpoint(!1);i.debug(`got revocation endpoint, revoking ${null!=(t=e.token_type_hint)?t:"default token type"}`);const r=new URLSearchParams;for(const[t,i]of Object.entries(e))null!=i&&r.set(t,i);r.set("client_id",this._settings.client_id),this._settings.client_secret&&r.set("client_secret",this._settings.client_secret),await this._jsonService.postForm(n,{body:r}),i.debug("got response")}},U=["nbf","jti","auth_time","nonce","acr","amr","azp","at_hash"],A=["sub","iss","aud","exp","iat"],L=class{constructor(e){this.id=e.id||m.generateUUIDv4(),this.data=e.data,e.created&&e.created>0?this.created=e.created:this.created=b.getEpochTime(),this.request_type=e.request_type}toStorageString(){return new _("State").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type})}static fromStorageString(e){return _.createStatic("State","fromStorageString"),new L(JSON.parse(e))}static async clearStaleState(e,t){const i=_.createStatic("State","clearStaleState"),n=b.getEpochTime()-t,r=await e.getAllKeys();i.debug("got keys",r);for(let t=0;t<r.length;t++){const s=r[t],o=await e.get(s);let a=!1;if(o)try{const e=L.fromStorageString(o);i.debug("got item from key:",s,e.created),e.created<=n&&(a=!0)}catch(e){i.error("Error parsing state for key:",s,e),a=!0}else i.debug("no item in storage for key:",s),a=!0;a&&(i.debug("removed item for key:",s),e.remove(s))}}},M=class extends L{constructor(e){super(e),!0===e.code_verifier?this.code_verifier=m.generateCodeVerifier():e.code_verifier&&(this.code_verifier=e.code_verifier),this.code_verifier&&(this.code_challenge=m.generateCodeChallenge(this.code_verifier)),this.authority=e.authority,this.client_id=e.client_id,this.redirect_uri=e.redirect_uri,this.scope=e.scope,this.client_secret=e.client_secret,this.extraTokenParams=e.extraTokenParams,this.response_mode=e.response_mode,this.skipUserInfo=e.skipUserInfo}toStorageString(){return new _("SigninState").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,code_verifier:this.code_verifier,authority:this.authority,client_id:this.client_id,redirect_uri:this.redirect_uri,scope:this.scope,client_secret:this.client_secret,extraTokenParams:this.extraTokenParams,response_mode:this.response_mode,skipUserInfo:this.skipUserInfo})}static fromStorageString(e){_.createStatic("SigninState","fromStorageString");const t=JSON.parse(e);return new M(t)}},j=class{constructor(e){this.access_token="",this.token_type="",this.profile={},this.state=e.get("state"),this.session_state=e.get("session_state"),this.error=e.get("error"),this.error_description=e.get("error_description"),this.error_uri=e.get("error_uri"),this.code=e.get("code")}get expires_in(){if(void 0!==this.expires_at)return this.expires_at-b.getEpochTime()}set expires_in(e){"string"==typeof e&&(e=Number(e)),void 0!==e&&e>=0&&(this.expires_at=Math.floor(e)+b.getEpochTime())}get isOpenId(){var e;return(null==(e=this.scope)?void 0:e.split(" ").includes("openid"))||!!this.id_token}},N=class{constructor(e){var t;this.id_token=e.id_token,this.session_state=null!=(t=e.session_state)?t:null,this.access_token=e.access_token,this.refresh_token=e.refresh_token,this.token_type=e.token_type,this.scope=e.scope,this.profile=e.profile,this.expires_at=e.expires_at,this.state=e.userState}get expires_in(){if(void 0!==this.expires_at)return this.expires_at-b.getEpochTime()}set expires_in(e){void 0!==e&&(this.expires_at=Math.floor(e)+b.getEpochTime())}get expired(){const e=this.expires_in;if(void 0!==e)return e<=0}get scopes(){var e,t;return null!=(t=null==(e=this.scope)?void 0:e.split(" "))?t:[]}toStorageString(){return new _("User").create("toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})}static fromStorageString(e){return _.createStatic("User","fromStorageString"),new N(JSON.parse(e))}},q="oidc-client",$=class{constructor(){this._abort=new y("Window navigation aborted"),this._disposeHandlers=new Set,this._window=null}async navigate(e){const t=this._logger.create("navigate");if(!this._window)throw new Error("Attempted to navigate on a disposed window");t.debug("setting URL in window"),this._window.location.replace(e.url);const{url:i,keepOpen:n}=await new Promise(((i,n)=>{const r=r=>{var s;const o=r.data,a=null!=(s=e.scriptOrigin)?s:window.location.origin;if(r.origin===a&&(null==o?void 0:o.source)===q){try{const i=k.readParams(o.url,e.response_mode).get("state");if(i||t.warn("no state found in response url"),r.source!==this._window&&i!==e.state)return}catch(e){this._dispose(),n(new Error("Invalid response from window"))}i(o)}};window.addEventListener("message",r,!1),this._disposeHandlers.add((()=>window.removeEventListener("message",r,!1))),this._disposeHandlers.add(this._abort.addHandler((e=>{this._dispose(),n(e)})))}));return t.debug("got response from window"),this._dispose(),n||this.close(),{url:i}}_dispose(){this._logger.create("_dispose");for(const e of this._disposeHandlers)e();this._disposeHandlers.clear()}static _notifyParent(e,t,i=!1,n=window.location.origin){e.postMessage({source:q,url:t,keepOpen:i},n)}},H={location:!1,toolbar:!1,height:640},B="_blank",J=60,G=2,F=10,D=class extends R{constructor(e){const{popup_redirect_uri:t=e.redirect_uri,popup_post_logout_redirect_uri:i=e.post_logout_redirect_uri,popupWindowFeatures:n=H,popupWindowTarget:r=B,redirectMethod:s="assign",redirectTarget:o="self",iframeNotifyParentOrigin:a=e.iframeNotifyParentOrigin,iframeScriptOrigin:c=e.iframeScriptOrigin,silent_redirect_uri:l=e.redirect_uri,silentRequestTimeoutInSeconds:d=F,automaticSilentRenew:u=!0,validateSubOnSilentRenew:g=!0,includeIdTokenInSilentRenew:h=!1,monitorSession:p=!1,monitorAnonymousSession:w=!1,checkSessionIntervalInSeconds:f=G,query_status_response_type:_="code",stopCheckSessionOnError:m=!0,revokeTokenTypes:y=["access_token","refresh_token"],revokeTokensOnSignout:v=!1,includeIdTokenInSilentSignout:S=!1,accessTokenExpiringNotificationTimeInSeconds:b=J,userStore:k}=e;if(super(e),this.popup_redirect_uri=t,this.popup_post_logout_redirect_uri=i,this.popupWindowFeatures=n,this.popupWindowTarget=r,this.redirectMethod=s,this.redirectTarget=o,this.iframeNotifyParentOrigin=a,this.iframeScriptOrigin=c,this.silent_redirect_uri=l,this.silentRequestTimeoutInSeconds=d,this.automaticSilentRenew=u,this.validateSubOnSilentRenew=g,this.includeIdTokenInSilentRenew=h,this.monitorSession=p,this.monitorAnonymousSession=w,this.checkSessionIntervalInSeconds=f,this.stopCheckSessionOnError=m,this.query_status_response_type=_,this.revokeTokenTypes=y,this.revokeTokensOnSignout=v,this.includeIdTokenInSilentSignout=S,this.accessTokenExpiringNotificationTimeInSeconds=b,k)this.userStore=k;else{const e="undefined"!=typeof window?window.sessionStorage:new x;this.userStore=new E({store:e})}}},W=class extends ${constructor({silentRequestTimeoutInSeconds:e=F}){super(),this._logger=new _("IFrameWindow"),this._timeoutInSeconds=e,this._frame=W.createHiddenIframe(),this._window=this._frame.contentWindow}static createHiddenIframe(){const e=window.document.createElement("iframe");return e.style.visibility="hidden",e.style.position="fixed",e.style.left="-1000px",e.style.top="0",e.width="0",e.height="0",e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),window.document.body.appendChild(e),e}async navigate(e){this._logger.debug("navigate: Using timeout of:",this._timeoutInSeconds);const t=setTimeout((()=>this._abort.raise(new I("IFrame timed out without a response"))),1e3*this._timeoutInSeconds);return this._disposeHandlers.add((()=>clearTimeout(t))),await super.navigate(e)}close(){var e;this._frame&&(this._frame.parentNode&&(this._frame.addEventListener("load",(e=>{var t;const i=e.target;null==(t=i.parentNode)||t.removeChild(i),this._abort.raise(new Error("IFrame removed from DOM"))}),!0),null==(e=this._frame.contentWindow)||e.location.replace("about:blank")),this._frame=null),this._window=null}static notifyParent(e,t){return super._notifyParent(window.parent,e,!1,t)}},z=class extends ${constructor({popupWindowTarget:e=B,popupWindowFeatures:t={}}){super(),this._logger=new _("PopupWindow");const i=S.center({...H,...t});this._window=window.open(void 0,e,S.serialize(i))}async navigate(e){var t;null==(t=this._window)||t.focus();const i=setInterval((()=>{this._window&&!this._window.closed||this._abort.raise(new Error("Popup closed by user"))}),500);return this._disposeHandlers.add((()=>clearInterval(i))),await super.navigate(e)}close(){this._window&&(this._window.closed||(this._window.close(),this._abort.raise(new Error("Popup closed")))),this._window=null}static notifyOpener(e,t){if(!window.opener)throw new Error("No window.opener. Can't complete notification.");return super._notifyParent(window.opener,e,t)}},K=class extends T{constructor(e){super({expiringNotificationTimeInSeconds:e.accessTokenExpiringNotificationTimeInSeconds}),this._logger=new _("UserManagerEvents"),this._userLoaded=new y("User loaded"),this._userUnloaded=new y("User unloaded"),this._silentRenewError=new y("Silent renew error"),this._userSignedIn=new y("User signed in"),this._userSignedOut=new y("User signed out"),this._userSessionChanged=new y("User session changed")}load(e,t=!0){super.load(e),t&&this._userLoaded.raise(e)}unload(){super.unload(),this._userUnloaded.raise()}addUserLoaded(e){return this._userLoaded.addHandler(e)}removeUserLoaded(e){return this._userLoaded.removeHandler(e)}addUserUnloaded(e){return this._userUnloaded.addHandler(e)}removeUserUnloaded(e){return this._userUnloaded.removeHandler(e)}addSilentRenewError(e){return this._silentRenewError.addHandler(e)}removeSilentRenewError(e){return this._silentRenewError.removeHandler(e)}_raiseSilentRenewError(e){this._silentRenewError.raise(e)}addUserSignedIn(e){return this._userSignedIn.addHandler(e)}removeUserSignedIn(e){this._userSignedIn.removeHandler(e)}_raiseUserSignedIn(){this._userSignedIn.raise()}addUserSignedOut(e){return this._userSignedOut.addHandler(e)}removeUserSignedOut(e){this._userSignedOut.removeHandler(e)}_raiseUserSignedOut(){this._userSignedOut.raise()}addUserSessionChanged(e){return this._userSessionChanged.addHandler(e)}removeUserSessionChanged(e){this._userSessionChanged.removeHandler(e)}_raiseUserSessionChanged(){this._userSessionChanged.raise()}},V=class{constructor(e){this._logger=new _("UserManager"),this.settings=new D(e),this._client=new class{constructor(e){this._logger=new _("OidcClient"),this.settings=new R(e),this.metadataService=new class{constructor(e){this._settings=e,this._logger=new _("MetadataService"),this._jsonService=new P(["application/jwk-set+json"]),this._signingKeys=null,this._metadata=null,this._metadataUrl=this._settings.metadataUrl,this._settings.signingKeys&&(this._logger.debug("using signingKeys from settings"),this._signingKeys=this._settings.signingKeys),this._settings.metadata&&(this._logger.debug("using metadata from settings"),this._metadata=this._settings.metadata),this._settings.fetchRequestCredentials&&(this._logger.debug("using fetchRequestCredentials from settings"),this._fetchRequestCredentials=this._settings.fetchRequestCredentials)}resetSigningKeys(){this._signingKeys=null}async getMetadata(){const e=this._logger.create("getMetadata");if(this._metadata)return e.debug("using cached values"),this._metadata;if(!this._metadataUrl)throw e.throw(new Error("No authority or metadataUrl configured on settings")),null;e.debug("getting metadata from",this._metadataUrl);const t=await this._jsonService.getJson(this._metadataUrl,{credentials:this._fetchRequestCredentials});return e.debug("merging remote JSON with seed metadata"),this._metadata=Object.assign({},this._settings.metadataSeed,t),this._metadata}getIssuer(){return this._getMetadataProperty("issuer")}getAuthorizationEndpoint(){return this._getMetadataProperty("authorization_endpoint")}getUserInfoEndpoint(){return this._getMetadataProperty("userinfo_endpoint")}getTokenEndpoint(e=!0){return this._getMetadataProperty("token_endpoint",e)}getCheckSessionIframe(){return this._getMetadataProperty("check_session_iframe",!0)}getEndSessionEndpoint(){return this._getMetadataProperty("end_session_endpoint",!0)}getRevocationEndpoint(e=!0){return this._getMetadataProperty("revocation_endpoint",e)}getKeysEndpoint(e=!0){return this._getMetadataProperty("jwks_uri",e)}async _getMetadataProperty(e,t=!1){const i=this._logger.create(`_getMetadataProperty('${e}')`),n=await this.getMetadata();if(i.debug("resolved"),void 0===n[e]){if(!0===t)return void i.warn("Metadata does not contain optional property");i.throw(new Error("Metadata does not contain property "+e))}return n[e]}async getSigningKeys(){const e=this._logger.create("getSigningKeys");if(this._signingKeys)return e.debug("returning signingKeys from cache"),this._signingKeys;const t=await this.getKeysEndpoint(!1);e.debug("got jwks_uri",t);const i=await this._jsonService.getJson(t);if(e.debug("got key set",i),!Array.isArray(i.keys))throw e.throw(new Error("Missing keys on keyset")),null;return this._signingKeys=i.keys,this._signingKeys}}(this.settings),this._validator=new class{constructor(e,t){this._settings=e,this._metadataService=t,this._logger=new _("ResponseValidator"),this._userInfoService=new class{constructor(e,t){this._settings=e,this._metadataService=t,this._logger=new _("UserInfoService"),this._getClaimsFromJwt=async e=>{const t=this._logger.create("_getClaimsFromJwt");try{const i=v.decode(e);return t.debug("JWT decoding successful"),i}catch(e){throw t.error("Error parsing JWT response"),e}},this._jsonService=new P(void 0,this._getClaimsFromJwt)}async getClaims(e){const t=this._logger.create("getClaims");e||this._logger.throw(new Error("No token passed"));const i=await this._metadataService.getUserInfoEndpoint();t.debug("got userinfo url",i);const n=await this._jsonService.getJson(i,{token:e,credentials:this._settings.fetchRequestCredentials});return t.debug("got claims",n),n}}(this._settings,this._metadataService),this._tokenClient=new O(this._settings,this._metadataService)}async validateSigninResponse(e,t){const i=this._logger.create("validateSigninResponse");this._processSigninState(e,t),i.debug("state processed"),await this._processCode(e,t),i.debug("code processed"),e.isOpenId&&this._validateIdTokenAttributes(e),i.debug("tokens validated"),await this._processClaims(e,null==t?void 0:t.skipUserInfo,e.isOpenId),i.debug("claims processed")}async validateCredentialsResponse(e,t){const i=this._logger.create("validateCredentialsResponse");e.isOpenId&&this._validateIdTokenAttributes(e),i.debug("tokens validated"),await this._processClaims(e,t,e.isOpenId),i.debug("claims processed")}async validateRefreshResponse(e,t){const i=this._logger.create("validateRefreshResponse");e.userState=t.data,null!=e.session_state||(e.session_state=t.session_state),null!=e.scope||(e.scope=t.scope),e.isOpenId&&e.id_token&&(this._validateIdTokenAttributes(e,t.id_token),i.debug("ID Token validated")),e.id_token||(e.id_token=t.id_token,e.profile=t.profile);const n=e.isOpenId&&!!e.id_token;await this._processClaims(e,!1,n),i.debug("claims processed")}validateSignoutResponse(e,t){const i=this._logger.create("validateSignoutResponse");if(t.id!==e.state&&i.throw(new Error("State does not match")),i.debug("state validated"),e.userState=t.data,e.error)throw i.warn("Response was error",e.error),new C(e)}_processSigninState(e,t){const i=this._logger.create("_processSigninState");if(t.id!==e.state&&i.throw(new Error("State does not match")),t.client_id||i.throw(new Error("No client_id on state")),t.authority||i.throw(new Error("No authority on state")),this._settings.authority!==t.authority&&i.throw(new Error("authority mismatch on settings vs. signin state")),this._settings.client_id&&this._settings.client_id!==t.client_id&&i.throw(new Error("client_id mismatch on settings vs. signin state")),i.debug("state validated"),e.userState=t.data,null!=e.scope||(e.scope=t.scope),e.error)throw i.warn("Response was error",e.error),new C(e);t.code_verifier&&!e.code&&i.throw(new Error("Expected code in response"))}async _processClaims(e,t=!1,i=!0){const n=this._logger.create("_processClaims");if(e.profile=this._filterProtocolClaims(e.profile),t||!this._settings.loadUserInfo||!e.access_token)return void n.debug("not loading user info");n.debug("loading user info");const r=await this._userInfoService.getClaims(e.access_token);n.debug("user info claims received from user info endpoint"),i&&r.sub!==e.profile.sub&&n.throw(new Error("subject from UserInfo response does not match subject in ID Token")),e.profile=this._mergeClaims(e.profile,this._filterProtocolClaims(r)),n.debug("user info claims received, updated profile:",e.profile)}_mergeClaims(e,t){const i={...e};for(const[e,n]of Object.entries(t))for(const t of Array.isArray(n)?n:[n]){const n=i[e];n?Array.isArray(n)?n.includes(t)||n.push(t):i[e]!==t&&("object"==typeof t&&this._settings.mergeClaims?i[e]=this._mergeClaims(n,t):i[e]=[n,t]):i[e]=t}return i}_filterProtocolClaims(e){const t={...e};if(this._settings.filterProtocolClaims){let e;e=Array.isArray(this._settings.filterProtocolClaims)?this._settings.filterProtocolClaims:U;for(const i of e)A.includes(i)||delete t[i]}return t}async _processCode(e,t){const i=this._logger.create("_processCode");if(e.code){i.debug("Validating code");const n=await this._tokenClient.exchangeCode({client_id:t.client_id,client_secret:t.client_secret,code:e.code,redirect_uri:t.redirect_uri,code_verifier:t.code_verifier,...t.extraTokenParams});Object.assign(e,n)}else i.debug("No code to process")}_validateIdTokenAttributes(e,t){var i;const n=this._logger.create("_validateIdTokenAttributes");n.debug("decoding ID Token JWT");const r=v.decode(null!=(i=e.id_token)?i:"");if(r.sub||n.throw(new Error("ID Token is missing a subject claim")),t){const e=v.decode(t);e.sub!==r.sub&&n.throw(new Error("sub in id_token does not match current sub")),e.auth_time&&e.auth_time!==r.auth_time&&n.throw(new Error("auth_time in id_token does not match original auth_time")),e.azp&&e.azp!==r.azp&&n.throw(new Error("azp in id_token does not match original azp")),!e.azp&&r.azp&&n.throw(new Error("azp not in id_token, but present in original id_token"))}e.profile=r}}(this.settings,this.metadataService),this._tokenClient=new O(this.settings,this.metadataService)}async createSigninRequest({state:e,request:t,request_uri:i,request_type:n,id_token_hint:r,login_hint:s,skipUserInfo:o,nonce:a,response_type:c=this.settings.response_type,scope:l=this.settings.scope,redirect_uri:d=this.settings.redirect_uri,prompt:u=this.settings.prompt,display:g=this.settings.display,max_age:h=this.settings.max_age,ui_locales:p=this.settings.ui_locales,acr_values:w=this.settings.acr_values,resource:f=this.settings.resource,response_mode:m=this.settings.response_mode,extraQueryParams:y=this.settings.extraQueryParams,extraTokenParams:v=this.settings.extraTokenParams}){const S=this._logger.create("createSigninRequest");if("code"!==c)throw new Error("Only the Authorization Code flow (with PKCE) is supported");const b=await this.metadataService.getAuthorizationEndpoint();S.debug("Received authorization endpoint",b);const k=new class{constructor({url:e,authority:t,client_id:i,redirect_uri:n,response_type:r,scope:s,state_data:o,response_mode:a,request_type:c,client_secret:l,nonce:d,resource:u,skipUserInfo:g,extraQueryParams:h,extraTokenParams:p,disablePKCE:w,...f}){if(this._logger=new _("SigninRequest"),!e)throw this._logger.error("ctor: No url passed"),new Error("url");if(!i)throw this._logger.error("ctor: No client_id passed"),new Error("client_id");if(!n)throw this._logger.error("ctor: No redirect_uri passed"),new Error("redirect_uri");if(!r)throw this._logger.error("ctor: No response_type passed"),new Error("response_type");if(!s)throw this._logger.error("ctor: No scope passed"),new Error("scope");if(!t)throw this._logger.error("ctor: No authority passed"),new Error("authority");this.state=new M({data:o,request_type:c,code_verifier:!w,client_id:i,authority:t,redirect_uri:n,response_mode:a,client_secret:l,scope:s,extraTokenParams:p,skipUserInfo:g});const m=new URL(e);m.searchParams.append("client_id",i),m.searchParams.append("redirect_uri",n),m.searchParams.append("response_type",r),m.searchParams.append("scope",s),d&&m.searchParams.append("nonce",d),m.searchParams.append("state",this.state.id),this.state.code_challenge&&(m.searchParams.append("code_challenge",this.state.code_challenge),m.searchParams.append("code_challenge_method","S256")),u&&(Array.isArray(u)?u:[u]).forEach((e=>m.searchParams.append("resource",e)));for(const[e,t]of Object.entries({response_mode:a,...f,...h}))null!=t&&m.searchParams.append(e,t.toString());this.url=m.href}}({url:b,authority:this.settings.authority,client_id:this.settings.client_id,redirect_uri:d,response_type:c,scope:l,state_data:e,prompt:u,display:g,max_age:h,ui_locales:p,id_token_hint:r,login_hint:s,acr_values:w,resource:f,request:t,request_uri:i,extraQueryParams:y,extraTokenParams:v,request_type:n,response_mode:m,client_secret:this.settings.client_secret,skipUserInfo:o,nonce:a,disablePKCE:this.settings.disablePKCE});await this.clearStaleState();const C=k.state;return await this.settings.stateStore.set(C.id,C.toStorageString()),k}async readSigninResponseState(e,t=!1){const i=this._logger.create("readSigninResponseState"),n=new j(k.readParams(e,this.settings.response_mode));if(!n.state)throw i.throw(new Error("No state in response")),null;const r=await this.settings.stateStore[t?"remove":"get"](n.state);if(!r)throw i.throw(new Error("No matching state found in storage")),null;return{state:M.fromStorageString(r),response:n}}async processSigninResponse(e){const t=this._logger.create("processSigninResponse"),{state:i,response:n}=await this.readSigninResponseState(e,!0);return t.debug("received state from storage; validating response"),await this._validator.validateSigninResponse(n,i),n}async processResourceOwnerPasswordCredentials({username:e,password:t,skipUserInfo:i=!1,extraTokenParams:n={}}){const r=await this._tokenClient.exchangeCredentials({username:e,password:t,...n}),s=new j(new URLSearchParams);return Object.assign(s,r),await this._validator.validateCredentialsResponse(s,i),s}async useRefreshToken({state:e,timeoutInSeconds:t}){var i;const n=this._logger.create("useRefreshToken");let r;if(void 0===this.settings.refreshTokenAllowedScope)r=e.scope;else{const t=this.settings.refreshTokenAllowedScope.split(" ");r=((null==(i=e.scope)?void 0:i.split(" "))||[]).filter((e=>t.includes(e))).join(" ")}const s=await this._tokenClient.exchangeRefreshToken({refresh_token:e.refresh_token,scope:r,timeoutInSeconds:t}),o=new j(new URLSearchParams);return Object.assign(o,s),n.debug("validating response",o),await this._validator.validateRefreshResponse(o,{...e,scope:r}),o}async createSignoutRequest({state:e,id_token_hint:t,request_type:i,post_logout_redirect_uri:n=this.settings.post_logout_redirect_uri,extraQueryParams:r=this.settings.extraQueryParams}={}){const s=this._logger.create("createSignoutRequest"),o=await this.metadataService.getEndSessionEndpoint();if(!o)throw s.throw(new Error("No end session endpoint")),null;s.debug("Received end session endpoint",o);const a=new class{constructor({url:e,state_data:t,id_token_hint:i,post_logout_redirect_uri:n,extraQueryParams:r,request_type:s}){if(this._logger=new _("SignoutRequest"),!e)throw this._logger.error("ctor: No url passed"),new Error("url");const o=new URL(e);i&&o.searchParams.append("id_token_hint",i),n&&(o.searchParams.append("post_logout_redirect_uri",n),t&&(this.state=new L({data:t,request_type:s}),o.searchParams.append("state",this.state.id)));for(const[e,t]of Object.entries({...r}))null!=t&&o.searchParams.append(e,t.toString());this.url=o.href}}({url:o,id_token_hint:t,post_logout_redirect_uri:n,state_data:e,extraQueryParams:r,request_type:i});await this.clearStaleState();const c=a.state;return c&&(s.debug("Signout request has state to persist"),await this.settings.stateStore.set(c.id,c.toStorageString())),a}async readSignoutResponseState(e,t=!1){const i=this._logger.create("readSignoutResponseState"),n=new class{constructor(e){this.state=e.get("state"),this.error=e.get("error"),this.error_description=e.get("error_description"),this.error_uri=e.get("error_uri")}}(k.readParams(e,this.settings.response_mode));if(!n.state){if(i.debug("No state in response"),n.error)throw i.warn("Response was error:",n.error),new C(n);return{state:void 0,response:n}}const r=await this.settings.stateStore[t?"remove":"get"](n.state);if(!r)throw i.throw(new Error("No matching state found in storage")),null;return{state:L.fromStorageString(r),response:n}}async processSignoutResponse(e){const t=this._logger.create("processSignoutResponse"),{state:i,response:n}=await this.readSignoutResponseState(e,!0);return i?(t.debug("Received state from storage; validating response"),this._validator.validateSignoutResponse(n,i)):t.debug("No state from storage; skipping response validation"),n}clearStaleState(){return this._logger.create("clearStaleState"),L.clearStaleState(this.settings.stateStore,this.settings.staleStateAgeInSeconds)}async revokeToken(e,t){return this._logger.create("revokeToken"),await this._tokenClient.revoke({token:e,token_type_hint:t})}}(e),this._redirectNavigator=new class{constructor(e){this._settings=e,this._logger=new _("RedirectNavigator")}async prepare({redirectMethod:e=this._settings.redirectMethod,redirectTarget:t=this._settings.redirectTarget}){var i;this._logger.create("prepare");let n=window.self;"top"===t&&(n=null!=(i=window.top)?i:window.self);const r=n.location[e].bind(n.location);let s;return{navigate:async e=>{this._logger.create("navigate");const t=new Promise(((e,t)=>{s=t}));return r(e.url),await t},close:()=>{this._logger.create("close"),null==s||s(new Error("Redirect aborted")),n.stop()}}}}(this.settings),this._popupNavigator=new class{constructor(e){this._settings=e,this._logger=new _("PopupNavigator")}async prepare({popupWindowFeatures:e=this._settings.popupWindowFeatures,popupWindowTarget:t=this._settings.popupWindowTarget}){return new z({popupWindowFeatures:e,popupWindowTarget:t})}async callback(e,t=!1){this._logger.create("callback"),z.notifyOpener(e,t)}}(this.settings),this._iframeNavigator=new class{constructor(e){this._settings=e,this._logger=new _("IFrameNavigator")}async prepare({silentRequestTimeoutInSeconds:e=this._settings.silentRequestTimeoutInSeconds}){return new W({silentRequestTimeoutInSeconds:e})}async callback(e){this._logger.create("callback"),W.notifyParent(e,this._settings.iframeNotifyParentOrigin)}}(this.settings),this._events=new K(this.settings),this._silentRenewService=new class{constructor(e){this._userManager=e,this._logger=new _("SilentRenewService"),this._isStarted=!1,this._retryTimer=new b("Retry Silent Renew"),this._tokenExpiring=async()=>{const e=this._logger.create("_tokenExpiring");try{await this._userManager.signinSilent(),e.debug("silent token renewal successful")}catch(t){if(t instanceof I)return e.warn("ErrorTimeout from signinSilent:",t,"retry in 5s"),void this._retryTimer.init(5);e.error("Error from signinSilent:",t),this._userManager.events._raiseSilentRenewError(t)}}}async start(){const e=this._logger.create("start");if(!this._isStarted){this._isStarted=!0,this._userManager.events.addAccessTokenExpiring(this._tokenExpiring),this._retryTimer.addHandler(this._tokenExpiring);try{await this._userManager.getUser()}catch(t){e.error("getUser error",t)}}}stop(){this._isStarted&&(this._retryTimer.cancel(),this._retryTimer.removeHandler(this._tokenExpiring),this._userManager.events.removeAccessTokenExpiring(this._tokenExpiring),this._isStarted=!1)}}(this),this.settings.automaticSilentRenew&&this.startSilentRenew(),this._sessionMonitor=null,this.settings.monitorSession&&(this._sessionMonitor=new class{constructor(e){this._userManager=e,this._logger=new _("SessionMonitor"),this._start=async e=>{const t=e.session_state;if(!t)return;const i=this._logger.create("_start");if(e.profile?(this._sub=e.profile.sub,this._sid=e.profile.sid,i.debug("session_state",t,", sub",this._sub)):(this._sub=void 0,this._sid=void 0,i.debug("session_state",t,", anonymous user")),this._checkSessionIFrame)this._checkSessionIFrame.start(t);else try{const e=await this._userManager.metadataService.getCheckSessionIframe();if(e){i.debug("initializing check session iframe");const n=this._userManager.settings.client_id,r=this._userManager.settings.checkSessionIntervalInSeconds,s=this._userManager.settings.stopCheckSessionOnError,o=new class{constructor(e,t,i,n,r){this._callback=e,this._client_id=t,this._intervalInSeconds=n,this._stopOnError=r,this._logger=new _("CheckSessionIFrame"),this._timer=null,this._session_state=null,this._message=e=>{e.origin===this._frame_origin&&e.source===this._frame.contentWindow&&("error"===e.data?(this._logger.error("error message from check session op iframe"),this._stopOnError&&this.stop()):"changed"===e.data?(this._logger.debug("changed message from check session op iframe"),this.stop(),this._callback()):this._logger.debug(e.data+" message from check session op iframe"))};const s=new URL(i);this._frame_origin=s.origin,this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="fixed",this._frame.style.left="-1000px",this._frame.style.top="0",this._frame.width="0",this._frame.height="0",this._frame.src=s.href}load(){return new Promise((e=>{this._frame.onload=()=>{e()},window.document.body.appendChild(this._frame),window.addEventListener("message",this._message,!1)}))}start(e){if(this._session_state===e)return;this._logger.create("start"),this.stop(),this._session_state=e;const t=()=>{this._frame.contentWindow&&this._session_state&&this._frame.contentWindow.postMessage(this._client_id+" "+this._session_state,this._frame_origin)};t(),this._timer=setInterval(t,1e3*this._intervalInSeconds)}stop(){this._logger.create("stop"),this._session_state=null,this._timer&&(clearInterval(this._timer),this._timer=null)}}(this._callback,n,e,r,s);await o.load(),this._checkSessionIFrame=o,o.start(t)}else i.warn("no check session iframe found in the metadata")}catch(e){i.error("Error from getCheckSessionIframe:",e instanceof Error?e.message:e)}},this._stop=()=>{const e=this._logger.create("_stop");if(this._sub=void 0,this._sid=void 0,this._checkSessionIFrame&&this._checkSessionIFrame.stop(),this._userManager.settings.monitorAnonymousSession){const t=setInterval((async()=>{clearInterval(t);try{const e=await this._userManager.querySessionStatus();if(e){const t={session_state:e.session_state,profile:e.sub&&e.sid?{sub:e.sub,sid:e.sid}:null};this._start(t)}}catch(t){e.error("error from querySessionStatus",t instanceof Error?t.message:t)}}),1e3)}},this._callback=async()=>{const e=this._logger.create("_callback");try{const t=await this._userManager.querySessionStatus();let i=!0;t&&this._checkSessionIFrame?t.sub===this._sub?(i=!1,this._checkSessionIFrame.start(t.session_state),t.sid===this._sid?e.debug("same sub still logged in at OP, restarting check session iframe; session_state",t.session_state):(e.debug("same sub still logged in at OP, session state has changed, restarting check session iframe; session_state",t.session_state),this._userManager.events._raiseUserSessionChanged())):e.debug("different subject signed into OP",t.sub):e.debug("subject no longer signed into OP"),i?this._sub?this._userManager.events._raiseUserSignedOut():this._userManager.events._raiseUserSignedIn():e.debug("no change in session detected, no event to raise")}catch(t){this._sub&&(e.debug("Error calling queryCurrentSigninSession; raising signed out event",t),this._userManager.events._raiseUserSignedOut())}},e||this._logger.throw(new Error("No user manager passed")),this._userManager.events.addUserLoaded(this._start),this._userManager.events.addUserUnloaded(this._stop),this._init().catch((e=>{this._logger.error(e)}))}async _init(){this._logger.create("_init");const e=await this._userManager.getUser();if(e)this._start(e);else if(this._userManager.settings.monitorAnonymousSession){const e=await this._userManager.querySessionStatus();if(e){const t={session_state:e.session_state,profile:e.sub&&e.sid?{sub:e.sub,sid:e.sid}:null};this._start(t)}}}}(this))}get events(){return this._events}get metadataService(){return this._client.metadataService}async getUser(){const e=this._logger.create("getUser"),t=await this._loadUser();return t?(e.info("user loaded"),this._events.load(t,!1),t):(e.info("user not found in storage"),null)}async removeUser(){const e=this._logger.create("removeUser");await this.storeUser(null),e.info("user removed from storage"),this._events.unload()}async signinRedirect(e={}){this._logger.create("signinRedirect");const{redirectMethod:t,...i}=e,n=await this._redirectNavigator.prepare({redirectMethod:t});await this._signinStart({request_type:"si:r",...i},n)}async signinRedirectCallback(e=window.location.href){const t=this._logger.create("signinRedirectCallback"),i=await this._signinEnd(e);return i.profile&&i.profile.sub?t.info("success, signed in subject",i.profile.sub):t.info("no subject"),i}async signinResourceOwnerCredentials({username:e,password:t,skipUserInfo:i=!1}){const n=this._logger.create("signinResourceOwnerCredential"),r=await this._client.processResourceOwnerPasswordCredentials({username:e,password:t,skipUserInfo:i,extraTokenParams:this.settings.extraTokenParams});n.debug("got signin response");const s=await this._buildUser(r);return s.profile&&s.profile.sub?n.info("success, signed in subject",s.profile.sub):n.info("no subject"),s}async signinPopup(e={}){const t=this._logger.create("signinPopup"),{popupWindowFeatures:i,popupWindowTarget:n,...r}=e,s=this.settings.popup_redirect_uri;s||t.throw(new Error("No popup_redirect_uri configured"));const o=await this._popupNavigator.prepare({popupWindowFeatures:i,popupWindowTarget:n}),a=await this._signin({request_type:"si:p",redirect_uri:s,display:"popup",...r},o);return a&&(a.profile&&a.profile.sub?t.info("success, signed in subject",a.profile.sub):t.info("no subject")),a}async signinPopupCallback(e=window.location.href,t=!1){const i=this._logger.create("signinPopupCallback");await this._popupNavigator.callback(e,t),i.info("success")}async signinSilent(e={}){var t;const i=this._logger.create("signinSilent"),{silentRequestTimeoutInSeconds:n,...r}=e;let s=await this._loadUser();if(null==s?void 0:s.refresh_token){i.debug("using refresh token");const e=new class{constructor(e){this.refresh_token=e.refresh_token,this.id_token=e.id_token,this.session_state=e.session_state,this.scope=e.scope,this.profile=e.profile,this.data=e.state}}(s);return await this._useRefreshToken(e)}const o=this.settings.silent_redirect_uri;let a;o||i.throw(new Error("No silent_redirect_uri configured")),s&&this.settings.validateSubOnSilentRenew&&(i.debug("subject prior to silent renew:",s.profile.sub),a=s.profile.sub);const c=await this._iframeNavigator.prepare({silentRequestTimeoutInSeconds:n});return s=await this._signin({request_type:"si:s",redirect_uri:o,prompt:"none",id_token_hint:this.settings.includeIdTokenInSilentRenew?null==s?void 0:s.id_token:void 0,...r},c,a),s&&((null==(t=s.profile)?void 0:t.sub)?i.info("success, signed in subject",s.profile.sub):i.info("no subject")),s}async _useRefreshToken(e){const t=await this._client.useRefreshToken({state:e,timeoutInSeconds:this.settings.silentRequestTimeoutInSeconds}),i=new N({...e,...t});return await this.storeUser(i),this._events.load(i),i}async signinSilentCallback(e=window.location.href){const t=this._logger.create("signinSilentCallback");await this._iframeNavigator.callback(e),t.info("success")}async signinCallback(e=window.location.href){const{state:t}=await this._client.readSigninResponseState(e);switch(t.request_type){case"si:r":return await this.signinRedirectCallback(e);case"si:p":return await this.signinPopupCallback(e);case"si:s":return await this.signinSilentCallback(e);default:throw new Error("invalid response_type in state")}}async signoutCallback(e=window.location.href,t=!1){const{state:i}=await this._client.readSignoutResponseState(e);if(i)switch(i.request_type){case"so:r":await this.signoutRedirectCallback(e);break;case"so:p":await this.signoutPopupCallback(e,t);break;case"so:s":await this.signoutSilentCallback(e);break;default:throw new Error("invalid response_type in state")}}async querySessionStatus(e={}){const t=this._logger.create("querySessionStatus"),{silentRequestTimeoutInSeconds:i,...n}=e,r=this.settings.silent_redirect_uri;r||t.throw(new Error("No silent_redirect_uri configured"));const s=await this._loadUser(),o=await this._iframeNavigator.prepare({silentRequestTimeoutInSeconds:i}),a=await this._signinStart({request_type:"si:s",redirect_uri:r,prompt:"none",id_token_hint:this.settings.includeIdTokenInSilentRenew?null==s?void 0:s.id_token:void 0,response_type:this.settings.query_status_response_type,scope:"openid",skipUserInfo:!0,...n},o);try{const e=await this._client.processSigninResponse(a.url);return t.debug("got signin response"),e.session_state&&e.profile.sub?(t.info("success for subject",e.profile.sub),{session_state:e.session_state,sub:e.profile.sub,sid:e.profile.sid}):(t.info("success, user not authenticated"),null)}catch(e){if(this.settings.monitorAnonymousSession&&e instanceof C)switch(e.error){case"login_required":case"consent_required":case"interaction_required":case"account_selection_required":return t.info("success for anonymous user"),{session_state:e.session_state}}throw e}}async _signin(e,t,i){const n=await this._signinStart(e,t);return await this._signinEnd(n.url,i)}async _signinStart(e,t){const i=this._logger.create("_signinStart");try{const n=await this._client.createSigninRequest(e);return i.debug("got signin request"),await t.navigate({url:n.url,state:n.state.id,response_mode:n.state.response_mode,scriptOrigin:this.settings.iframeScriptOrigin})}catch(e){throw i.debug("error after preparing navigator, closing navigator window"),t.close(),e}}async _signinEnd(e,t){const i=this._logger.create("_signinEnd"),n=await this._client.processSigninResponse(e);return i.debug("got signin response"),await this._buildUser(n,t)}async _buildUser(e,t){const i=this._logger.create("_buildUser"),n=new N(e);if(t){if(t!==n.profile.sub)throw i.debug("current user does not match user returned from signin. sub from signin:",n.profile.sub),new C({...e,error:"login_required"});i.debug("current user matches user returned from signin")}return await this.storeUser(n),i.debug("user stored"),this._events.load(n),n}async signoutRedirect(e={}){const t=this._logger.create("signoutRedirect"),{redirectMethod:i,...n}=e,r=await this._redirectNavigator.prepare({redirectMethod:i});await this._signoutStart({request_type:"so:r",post_logout_redirect_uri:this.settings.post_logout_redirect_uri,...n},r),t.info("success")}async signoutRedirectCallback(e=window.location.href){const t=this._logger.create("signoutRedirectCallback"),i=await this._signoutEnd(e);return t.info("success"),i}async signoutPopup(e={}){const t=this._logger.create("signoutPopup"),{popupWindowFeatures:i,popupWindowTarget:n,...r}=e,s=this.settings.popup_post_logout_redirect_uri,o=await this._popupNavigator.prepare({popupWindowFeatures:i,popupWindowTarget:n});await this._signout({request_type:"so:p",post_logout_redirect_uri:s,state:null==s?void 0:{},...r},o),t.info("success")}async signoutPopupCallback(e=window.location.href,t=!1){const i=this._logger.create("signoutPopupCallback");await this._popupNavigator.callback(e,t),i.info("success")}async _signout(e,t){const i=await this._signoutStart(e,t);return await this._signoutEnd(i.url)}async _signoutStart(e={},t){var i;const n=this._logger.create("_signoutStart");try{const r=await this._loadUser();n.debug("loaded current user from storage"),this.settings.revokeTokensOnSignout&&await this._revokeInternal(r);const s=e.id_token_hint||r&&r.id_token;s&&(n.debug("setting id_token_hint in signout request"),e.id_token_hint=s),await this.removeUser(),n.debug("user removed, creating signout request");const o=await this._client.createSignoutRequest(e);return n.debug("got signout request"),await t.navigate({url:o.url,state:null==(i=o.state)?void 0:i.id})}catch(e){throw n.debug("error after preparing navigator, closing navigator window"),t.close(),e}}async _signoutEnd(e){const t=this._logger.create("_signoutEnd"),i=await this._client.processSignoutResponse(e);return t.debug("got signout response"),i}async signoutSilent(e={}){var t;const i=this._logger.create("signoutSilent"),{silentRequestTimeoutInSeconds:n,...r}=e,s=this.settings.includeIdTokenInSilentSignout?null==(t=await this._loadUser())?void 0:t.id_token:void 0,o=this.settings.popup_post_logout_redirect_uri,a=await this._iframeNavigator.prepare({silentRequestTimeoutInSeconds:n});await this._signout({request_type:"so:s",post_logout_redirect_uri:o,id_token_hint:s,...r},a),i.info("success")}async signoutSilentCallback(e=window.location.href){const t=this._logger.create("signoutSilentCallback");await this._iframeNavigator.callback(e),t.info("success")}async revokeTokens(e){const t=await this._loadUser();await this._revokeInternal(t,e)}async _revokeInternal(e,t=this.settings.revokeTokenTypes){const i=this._logger.create("_revokeInternal");if(!e)return;const n=t.filter((t=>"string"==typeof e[t]));if(n.length){for(const t of n)await this._client.revokeToken(e[t],t),i.info(`${t} revoked successfully`),"access_token"!==t&&(e[t]=null);await this.storeUser(e),i.debug("user stored"),this._events.load(e)}else i.debug("no need to revoke due to no token(s)")}startSilentRenew(){this._logger.create("startSilentRenew"),this._silentRenewService.start()}stopSilentRenew(){this._silentRenewService.stop()}get _userStoreKey(){return`user:${this.settings.authority}:${this.settings.client_id}`}async _loadUser(){const e=this._logger.create("_loadUser"),t=await this.settings.userStore.get(this._userStoreKey);return t?(e.debug("user storageString loaded"),N.fromStorageString(t)):(e.debug("no user storageString"),null)}async storeUser(e){const t=this._logger.create("storeUser");if(e){t.debug("storing user");const i=e.toStorageString();await this.settings.userStore.set(this._userStoreKey,i)}else this._logger.debug("removing user"),await this.settings.userStore.remove(this._userStoreKey)}async clearStaleState(){await this._client.clearStaleState()}},Q=i(900),Y=i(970),Z=i(750),X=i(13),ee=i(274),te=i(984);class ie{constructor(e={path:"/"}){var t,i;i=void 0,(t="defaultAttributes")in this?Object.defineProperty(this,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):this[t]=i,this.defaultAttributes=e}setItem(e,t,i={}){const n={...this.defaultAttributes,...i};let r=encodeURIComponent(e)+"="+encodeURIComponent(t);if(n.expires){if("number"==typeof n.expires){const e=new Date;e.setTime(e.getTime()+24*n.expires*60*60*1e3),n.expires=e}r+="; expires="+n.expires.toUTCString()}n.path&&(r+="; path="+n.path),n.domain&&(r+="; domain="+n.domain),n.secure&&(r+="; secure"),n.sameSite&&(r+="; SameSite="+n.sameSite),document.cookie=r}getItem(e){const t=(document.cookie?document.cookie.split("; "):[]).find((t=>t.startsWith(`${encodeURIComponent(e)}=`)));return t?decodeURIComponent(t.split("=")[1]):null}removeItem(e){this.setItem(e,"",{expires:-1})}clear(){const e=document.cookie.split(";");for(const t of e){const e=t.indexOf("="),i=e>-1?t.substring(0,e):t;document.cookie=i+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}}}function ne(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const re=`oidc.user:${Q.GJ.hydraConf.authority}`,se={secure:!0,path:"/",domain:(oe=window.location.hostname,oe.replace(/^www\./,"").split(".").slice(-2).join(".")),sameSite:"None",expires:365};var oe;const ae=new class{constructor(e,t){ne(this,"withCookies",void 0),ne(this,"cookieStoreKey",void 0),ne(this,"cookieStorage",void 0),this.withCookies=t,this.cookieStoreKey=e,this.cookieStorage=new ie(se),X.u.debug(`LocalStorageCookieFallback: CookieStorage options.domain: ${se.domain}`)}getItem(e){let t=localStorage.getItem(e);return this.withCookies&&null===t&&(t=this.cookieStorage.getItem(this.cookieStoreKey),t&&localStorage.setItem(e,t)),t}setItem(e,t){localStorage.setItem(e,t),this.withCookies&&this.cookieStorage.setItem(this.cookieStoreKey,t)}removeItem(e){localStorage.removeItem(e),this.cookieStorage.removeItem(this.cookieStoreKey)}clear(){localStorage.clear(),this.cookieStorage.removeItem(this.cookieStoreKey)}key(e){return localStorage.key(e)}get length(){return localStorage.length}}(re,Q.GJ.extendLoginToSubdomains);function ce(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const le="idw-outdated";class de{constructor(e){ce(this,"pluginConfig",void 0),ce(this,"userManager",void 0),ce(this,"loginLock",void 0),ce(this,"pageUnloading",void 0),ce(this,"visibilitychangeSubscribed",void 0),this.pluginConfig=e;const t=Number(localStorage.getItem("idw-renew")),i={...this.pluginConfig.hydraConf,automaticSilentRenew:!1,userStore:new E({store:ae})};t&&t>0&&(i.accessTokenExpiringNotificationTimeInSeconds=t),this.userManager=new V(i),this.userManager.events.addAccessTokenExpired((()=>{X.u.debug("token expired, will queue OOF"),this.queueLogin()})),this.userManager.events.addAccessTokenExpiring((()=>{X.u.debug("token expiring, will queue OOF"),this.queueLogin()}))}queueLogin(){if(!this.pluginConfig.notLoginUser){const e=this.isImmediateLoginPage();let t=this.isLoginExceptionPage(),i=this.isLoginInclusionPage();if(e&&!t&&i)return void this.tryLoginHydra();X.u.debug("queue OOF"),window.addEventListener("beforeunload",(()=>{this.pageUnloading=!0})),this.visibilitychangeSubscribed?X.u.debug("visibilitychange already added, will not subscribe once more"):(X.u.debug("addEventListener visibilitychange"),this.visibilitychangeSubscribed=!0,addEventListener("visibilitychange",(()=>{t=this.isLoginExceptionPage(),i=this.isLoginInclusionPage(),"hidden"===document.visibilityState&&!t&&i&&this.tryLoginHydra()})))}}isImmediateLoginPage(){const e=this.pluginConfig.immediateLoginPages?.some((e=>window.location.href.includes(e.toLocaleLowerCase())));return e}isLoginExceptionPage(){const e=this.pluginConfig.loginExceptionPages?.some((e=>window.location.href.includes(e.toLocaleLowerCase())));return e}isLoginInclusionPage(){return!this.pluginConfig.loginInclusionPages||this.pluginConfig.loginInclusionPages.some((e=>window.location.href.includes(e.toLocaleLowerCase())))}async tryLoginHydra(e=window.location.href){if(this.loginLock||this.pageUnloading)return;const t=Date.now(),i=await(0,te.c)(),n=Date.now()-t;if(i&&n<=1750)await this.loginHydra(e);else if(i){X.u.warn("health check took more than 500ms, network connection is too slow. Will not do OOF");const e={method:"GET",headers:{"Content-Type":"application/json",acc_uuid:window.localStorage.getItem(le),url:encodeURIComponent(window.location.href),health_check_time:n.toString()}};fetch(`${Q.GJ.idwServicesConf.idwMetricsCollector}/debug/health`,e).catch((e=>{console.warn("Anonymised tag: failed to GET metrics/collect/debug/health",e)}))}else X.u.error("health check has failed, will not do OOF")}async loginHydra(e){if(this.loginLock)return;if(this.loginLock=!0,window.location.search.includes("callback=in"))return void X.u.debug("terminate an attempt to OOF during the callback redirect");if(Y.s.get(Z.dR.IdwHydraHasErrorKey)){const e="Error: terminate an attempt to OOF while being in PLUGIN_OFFLINE mode";return void X.u.debug(e)}window.localStorage.setItem("idw-signin-from",e),window.sessionStorage.setItem(Z.dR.idwScrollY,window.scrollY.toString()),void 0!==window.IdwCollect&&(window.IdwCollect.beforeLoginRedirect=!0);const t={...this.pluginConfig.hydraConf,automaticSilentRenew:!1,redirect_uri:(0,ee.f)(e,{callback:"in"}),userStore:new E({store:ae})},i=window.localStorage.getItem(le);i&&(t.extraQueryParams={outdated:i}),X.u.debug("update hydraConf.redirect_uri:",t.redirect_uri),this.userManager=new V(t),X.u.debug("start OOF");try{await this.userManager.signinRedirect({state:{signInFrom:window.location.href}})}catch(e){X.u.error(`OOF error: ${e}`)}}logoutHydra(){this.userManager.clearStaleState(),this.userManager.signoutRedirect()}async getUser(){return this.userManager.getUser()}}function ue(e){const t={method:"GET",headers:{"Content-Type":"application/json",acc_uuid:e,url:encodeURIComponent(window.location.href)}};fetch(`${Q.GJ.idwServicesConf.idwMetricsCollector}/ok`,t).catch((e=>{console.warn("Anonymised tag: failed to GET metrics/collect/ok",e)}))}async function ge(){const e={...Q.GJ.hydraConf,automaticSilentRenew:!1,userStore:new E({store:ae})},t=new V(e);try{const e=await t.signinRedirectCallback();if(e.expires_in){const t=Math.round(e.expires_in/3).toString();window.localStorage.setItem("idw-renew",t)}const i=await async function(e){try{return u(e).sub}catch(e){return console.warn("Anonymised tag: failed to parse JWT token",e),null}}(e.access_token);!function(e){const t={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e}};fetch(`${Q.GJ.idwServicesConf.idwMetricsRootUrl}/v2/info?event_trigger_type=login`,t).catch((e=>{console.warn("Anonymised tag: failed to GET /v2/info",e)}))}(e.access_token),ue(i),localStorage.setItem(le,i)}catch(e){ue("OOF callback error"),console.error("Anonymised tag: OOF callback error",e)}finally{console.debug("Anonymised tag: OOF callback done")}}},970:(e,t,i)=>{"use strict";i.d(t,{s:()=>n});const n={set:function(e,t,i){const n={value:t,expiresAt:Date.now()+1e3*i};localStorage.setItem(e.toString(),JSON.stringify(n))},get:function(e){const t=JSON.parse(localStorage.getItem(e.toString()));if(null!==t){if(!(null!==t.expiresAt&&t.expiresAt<Date.now()))return t.value;localStorage.removeItem(e.toString())}return null}}},274:(e,t,i)=>{"use strict";i.d(t,{f:()=>n});const n=(e,t)=>{const i=new URL(e),n=new URLSearchParams(i.search);for(const e in t)void 0!==t[e]&&n.set(e,t[e]);return i.search=n.toString(),i.hash="",i.toString()}},13:(e,t,i)=>{"use strict";i.d(t,{u:()=>o});var n=i(43),r=i.n(n);const s="Anonymised tag:",o={setDefaultLevel:e=>{"DEV"===e&&r().setDefaultLevel("DEBUG")},trace:(...e)=>{r().trace(s,...e)},debug:(...e)=>{r().debug(s,...e)},info:(...e)=>{r().info(s,...e)},warn:(...e)=>{r().warn(s,...e)},error:(...e)=>{r().error(s,...e)}}},249:function(e,t,i){var n;e.exports=(n=n||function(e,t){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==i.g&&i.g.crypto&&(n=i.g.crypto),!n)try{n=i(480)}catch(e){}var r=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},s=Object.create||function(){function e(){}return function(t){var i;return e.prototype=t,i=new e,e.prototype=null,i}}(),o={},a=o.lib={},c=a.Base={extend:function(e){var t=s(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=a.WordArray=c.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,i=e.words,n=this.sigBytes,r=e.sigBytes;if(this.clamp(),n%4)for(var s=0;s<r;s++){var o=i[s>>>2]>>>24-s%4*8&255;t[n+s>>>2]|=o<<24-(n+s)%4*8}else for(var a=0;a<r;a+=4)t[n+a>>>2]=i[a>>>2];return this.sigBytes+=r,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=c.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],i=0;i<e;i+=4)t.push(r());return new l.init(t,e)}}),d=o.enc={},u=d.Hex={stringify:function(e){for(var t=e.words,i=e.sigBytes,n=[],r=0;r<i;r++){var s=t[r>>>2]>>>24-r%4*8&255;n.push((s>>>4).toString(16)),n.push((15&s).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n+=2)i[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new l.init(i,t/2)}},g=d.Latin1={stringify:function(e){for(var t=e.words,i=e.sigBytes,n=[],r=0;r<i;r++){var s=t[r>>>2]>>>24-r%4*8&255;n.push(String.fromCharCode(s))}return n.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n++)i[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new l.init(i,t)}},h=d.Utf8={stringify:function(e){try{return decodeURIComponent(escape(g.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return g.parse(unescape(encodeURIComponent(e)))}},p=a.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i,n=this._data,r=n.words,s=n.sigBytes,o=this.blockSize,a=s/(4*o),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,d=e.min(4*c,s);if(c){for(var u=0;u<c;u+=o)this._doProcessBlock(r,u);i=r.splice(0,c),n.sigBytes-=d}return new l.init(i,d)},clone:function(){var e=c.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),w=(a.Hasher=p.extend({cfg:c.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new w.HMAC.init(e,i).finalize(t)}}}),o.algo={});return o}(Math),n)},269:function(e,t,i){var n,r,s;e.exports=(n=i(249),s=(r=n).lib.WordArray,r.enc.Base64={stringify:function(e){var t=e.words,i=e.sigBytes,n=this._map;e.clamp();for(var r=[],s=0;s<i;s+=3)for(var o=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,a=0;a<4&&s+.75*a<i;a++)r.push(n.charAt(o>>>6*(3-a)&63));var c=n.charAt(64);if(c)for(;r.length%4;)r.push(c);return r.join("")},parse:function(e){var t=e.length,i=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var r=0;r<i.length;r++)n[i.charCodeAt(r)]=r}var o=i.charAt(64);if(o){var a=e.indexOf(o);-1!==a&&(t=a)}return function(e,t,i){for(var n=[],r=0,o=0;o<t;o++)if(o%4){var a=i[e.charCodeAt(o-1)]<<o%4*2|i[e.charCodeAt(o)]>>>6-o%4*2;n[r>>>2]|=a<<24-r%4*8,r++}return s.create(n,r)}(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},n.enc.Base64)},743:function(e,t,i){e.exports=i(249).enc.Utf8},153:function(e,t,i){var n;e.exports=(n=i(249),function(e){var t=n,i=t.lib,r=i.WordArray,s=i.Hasher,o=t.algo,a=[],c=[];!function(){function t(t){for(var i=e.sqrt(t),n=2;n<=i;n++)if(!(t%n))return!1;return!0}function i(e){return 4294967296*(e-(0|e))|0}for(var n=2,r=0;r<64;)t(n)&&(r<8&&(a[r]=i(e.pow(n,.5))),c[r]=i(e.pow(n,1/3)),r++),n++}();var l=[],d=o.SHA256=s.extend({_doReset:function(){this._hash=new r.init(a.slice(0))},_doProcessBlock:function(e,t){for(var i=this._hash.words,n=i[0],r=i[1],s=i[2],o=i[3],a=i[4],d=i[5],u=i[6],g=i[7],h=0;h<64;h++){if(h<16)l[h]=0|e[t+h];else{var p=l[h-15],w=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,f=l[h-2],_=(f<<15|f>>>17)^(f<<13|f>>>19)^f>>>10;l[h]=w+l[h-7]+_+l[h-16]}var m=n&r^n&s^r&s,y=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),v=g+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&d^~a&u)+c[h]+l[h];g=u,u=d,d=a,a=o+v|0,o=s,s=r,r=n,n=v+(y+m)|0}i[0]=i[0]+n|0,i[1]=i[1]+r|0,i[2]=i[2]+s|0,i[3]=i[3]+o|0,i[4]=i[4]+a|0,i[5]=i[5]+d|0,i[6]=i[6]+u|0,i[7]=i[7]+g|0},_doFinalize:function(){var t=this._data,i=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;return i[r>>>5]|=128<<24-r%32,i[14+(r+64>>>9<<4)]=e.floor(n/4294967296),i[15+(r+64>>>9<<4)]=n,t.sigBytes=4*i.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=s._createHelper(d),t.HmacSHA256=s._createHmacHelper(d)}(Math),n.SHA256)},21:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(645),r=i.n(n)()(!1);r.push([e.id,"@import url(https://fonts.googleapis.com/css2?family=Open+Sans:wght@500;600&display=swap);"]),r.push([e.id,"#idw_plugin_container {\n    display: flex;\n    flex-direction: column;\n    box-sizing: content-box;\n    position: fixed;\n    left: -160px;\n    bottom: -160px;\n    z-index: 999999;\n    background-color: #fff;\n\n    height: auto;\n    max-width: 160px;\n    width: 160px;\n    min-width: 160px;\n    color: #171717;\n    line-height: 1rem;\n\n    outline: 1px solid #171717;\n    justify-content: flex-start;\n\n    -webkit-box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    -moz-box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    opacity: 0;\n    transition: left .4s, bottom .4s, opacity .1s;\n}\n\n#idw_plugin_container.idw-open {\n    left: 0;\n    bottom: 0;\n    opacity: 1;\n}\n\n#idward-plugin-buttons {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    width: auto;\n}\n\n#idw_plugin_container .pluginBtn {\n    border: none;\n    padding: 1px 5px !important;\n    margin: 0 !important;\n    width: auto !important;\n    height: 25px !important;\n    box-sizing: border-box !important;\n\n    border-radius: 0 !important;\n    text-align: right !important;\n\n    font-family: 'Open Sans', sans-serif !important;\n    line-height: normal !important;\n    text-transform: none !important;\n    letter-spacing: normal !important;\n    font-weight: 600 !important;\n    font-size: 14px !important;\n\n    background-color: #ffffff !important;\n    transition: background-color 0.2s;\n    cursor: pointer !important;\n}\n\n#idw_plugin_container .pluginBtn:hover {\n    outline: 1px solid #ffffff !important;\n    background-color: #171717 !important;\n    color: #ffffff !important;\n}\n\n#idward-open-trigger {\n    position: fixed;\n    width: 50px;\n    height: 50px;\n    bottom: 0;\n    left: 0;\n    z-index: 999999;\n    cursor: pointer;\n    -webkit-clip-path: polygon(100% 100%, 0 100%, 0 0);\n    clip-path: polygon(100% 100%, 0 100%, 0 0);\n    background-color: #171717 !important;\n}\n\n#idward-open-trigger img {\n    width: 28px;\n    height: 28px;\n    position: absolute;\n    /* padding: 4px; */\n    bottom: -2px;\n    left: -2px;\n}",""]);const s=r},948:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var n=i(645),r=i.n(n)()(!1);r.push([e.id,"/***************/\n/*MEDIA QUERIES*/\n/***************/\n/*\n  ##Device: Tablets, Ipads (portrait)\n  ##Screen: B/w 768px to 1024px\n*/\n@media (min-width: 768px) and (max-width: 1024px) {\n    \n}\n/*\n  ##Device: Most of the Smartphones Mobiles (Portrait)\n  ##Screen: B/w 320px to 479px\n*/\n@media (min-width: 400px) and (max-width: 480px) {\n\n}",""]);const s=r},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i,n,r,s=e[1]||"",o=e[3];if(!o)return s;if(t&&"function"==typeof btoa){var a=(i=o,n=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),"/*# ".concat(r," */")),c=o.sources.map((function(e){return"/*# sourceURL=".concat(o.sourceRoot||"").concat(e," */")}));return[s].concat(c).concat([a]).join("\n")}return[s].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(i,"}"):i})).join("")},t.i=function(e,i,n){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(n)for(var s=0;s<this.length;s++){var o=this[s][0];null!=o&&(r[o]=!0)}for(var a=0;a<e.length;a++){var c=[].concat(e[a]);n&&r[c[0]]||(i&&(c[2]?c[2]="".concat(i," and ").concat(c[2]):c[2]=i),t.push(c))}},t}},43:function(e,t,i){var n,r;!function(s,o){"use strict";n=function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function r(e,t){var i=e[t];if("function"==typeof i.bind)return i.bind(e);try{return Function.prototype.bind.call(i,e)}catch(t){return function(){return Function.prototype.apply.apply(i,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(t,i){for(var r=0;r<n.length;r++){var s=n[r];this[s]=r<t?e:this.methodFactory(s,t,i)}this.log=this.debug}function a(e,i,n){return function(){typeof console!==t&&(o.call(this,i,n),this[e].apply(this,arguments))}}function c(n,o,c){return function(n){return"debug"===n&&(n="log"),typeof console!==t&&("trace"===n&&i?s:void 0!==console[n]?r(console,n):void 0!==console.log?r(console,"log"):e)}(n)||a.apply(this,arguments)}function l(e,i,r){var s,a=this;i=null==i?"WARN":i;var l="loglevel";function d(){var e;if(typeof window!==t&&l){try{e=window.localStorage[l]}catch(e){}if(typeof e===t)try{var i=window.document.cookie,n=i.indexOf(encodeURIComponent(l)+"=");-1!==n&&(e=/^([^;]+)/.exec(i.slice(n))[1])}catch(e){}return void 0===a.levels[e]&&(e=void 0),e}}"string"==typeof e?l+=":"+e:"symbol"==typeof e&&(l=void 0),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=r||c,a.getLevel=function(){return s},a.setLevel=function(i,r){if("string"==typeof i&&void 0!==a.levels[i.toUpperCase()]&&(i=a.levels[i.toUpperCase()]),!("number"==typeof i&&i>=0&&i<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+i;if(s=i,!1!==r&&function(e){var i=(n[e]||"silent").toUpperCase();if(typeof window!==t&&l){try{return void(window.localStorage[l]=i)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"="+i+";"}catch(e){}}}(i),o.call(a,i,e),typeof console===t&&i<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){i=e,d()||a.setLevel(e,!1)},a.resetLevel=function(){a.setLevel(i,!1),function(){if(typeof window!==t&&l){try{return void window.localStorage.removeItem(l)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var u=d();null==u&&(u=i),a.setLevel(u,!1)}var d=new l,u={};d.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=u[e];return t||(t=u[e]=new l(e,d.getLevel(),d.methodFactory)),t};var g=typeof window!==t?window.log:void 0;return d.noConflict=function(){return typeof window!==t&&window.log===d&&(window.log=g),d},d.getLoggers=function(){return u},d.default=d,d},void 0===(r=n.call(t,i,t,e))||(e.exports=r)}()},666:e=>{var t=function(e){"use strict";var t,i=Object.prototype,n=i.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},s=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,i){return e[t]=i}}function l(e,t,i,n){var r=t&&t.prototype instanceof f?t:f,s=Object.create(r.prototype),o=new P(n||[]);return s._invoke=function(e,t,i){var n=u;return function(r,s){if(n===h)throw new Error("Generator is already running");if(n===p){if("throw"===r)throw s;return R()}for(i.method=r,i.arg=s;;){var o=i.delegate;if(o){var a=I(o,i);if(a){if(a===w)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(n===u)throw n=p,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n=h;var c=d(e,t,i);if("normal"===c.type){if(n=i.done?p:g,c.arg===w)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(n=p,i.method="throw",i.arg=c.arg)}}}(e,i,o),s}function d(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u="suspendedStart",g="suspendedYield",h="executing",p="completed",w={};function f(){}function _(){}function m(){}var y={};c(y,s,(function(){return this}));var v=Object.getPrototypeOf,S=v&&v(v(E([])));S&&S!==i&&n.call(S,s)&&(y=S);var b=m.prototype=f.prototype=Object.create(y);function k(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function i(r,s,o,a){var c=d(e[r],e,s);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,o,a)}),(function(e){i("throw",e,o,a)})):t.resolve(u).then((function(e){l.value=e,o(l)}),(function(e){return i("throw",e,o,a)}))}a(c.arg)}var r;this._invoke=function(e,n){function s(){return new t((function(t,r){i(e,n,t,r)}))}return r=r?r.then(s,s):s()}}function I(e,i){var n=e.iterator[i.method];if(n===t){if(i.delegate=null,"throw"===i.method){if(e.iterator.return&&(i.method="return",i.arg=t,I(e,i),"throw"===i.method))return w;i.method="throw",i.arg=new TypeError("The iterator does not provide a 'throw' method")}return w}var r=d(n,e.iterator,i.arg);if("throw"===r.type)return i.method="throw",i.arg=r.arg,i.delegate=null,w;var s=r.arg;return s?s.done?(i[e.resultName]=s.value,i.next=e.nextLoc,"return"!==i.method&&(i.method="next",i.arg=t),i.delegate=null,w):s:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,w)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function E(e){if(e){var i=e[s];if(i)return i.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function i(){for(;++r<e.length;)if(n.call(e,r))return i.value=e[r],i.done=!1,i;return i.value=t,i.done=!0,i};return o.next=o}}return{next:R}}function R(){return{value:t,done:!0}}return _.prototype=m,c(b,"constructor",m),c(m,"constructor",_),_.displayName=c(m,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,c(e,a,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},k(C.prototype),c(C.prototype,o,(function(){return this})),e.AsyncIterator=C,e.async=function(t,i,n,r,s){void 0===s&&(s=Promise);var o=new C(l(t,i,n,r),s);return e.isGeneratorFunction(i)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(b),c(b,a,"Generator"),c(b,s,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var n=t.pop();if(n in e)return i.value=n,i.done=!1,i}return i.done=!0,i}},e.values=E,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(x),!e)for(var i in this)"t"===i.charAt(0)&&n.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function r(n,r){return a.type="throw",a.arg=e,i.next=n,r&&(i.method="next",i.arg=t),!!r}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,w):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),w},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),x(i),w}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var n=i.completion;if("throw"===n.type){var r=n.arg;x(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,i,n){return this.delegate={iterator:E(e),resultName:i,nextLoc:n},"next"===this.method&&(this.arg=t),w}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},752:(e,t,i)=>{var n=i(379),r=i(21);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.id,r,""]]);n(r,{insert:"head",singleton:!1}),e.exports=r.locals||{}},362:(e,t,i)=>{var n=i(379),r=i(948);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.id,r,""]]);n(r,{insert:"head",singleton:!1}),e.exports=r.locals||{}},379:(e,t,i)=>{"use strict";var n,r=function(){var e={};return function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}e[t]=i}return e[t]}}(),s=[];function o(e){for(var t=-1,i=0;i<s.length;i++)if(s[i].identifier===e){t=i;break}return t}function a(e,t){for(var i={},n=[],r=0;r<e.length;r++){var a=e[r],c=t.base?a[0]+t.base:a[0],l=i[c]||0,d="".concat(c," ").concat(l);i[c]=l+1;var u=o(d),g={css:a[1],media:a[2],sourceMap:a[3]};-1!==u?(s[u].references++,s[u].updater(g)):s.push({identifier:d,updater:w(g,t),references:1}),n.push(d)}return n}function c(e){var t=document.createElement("style"),n=e.attributes||{};if(void 0===n.nonce){var s=i.nc;s&&(n.nonce=s)}if(Object.keys(n).forEach((function(e){t.setAttribute(e,n[e])})),"function"==typeof e.insert)e.insert(t);else{var o=r(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}return t}var l,d=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function u(e,t,i,n){var r=i?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(e.styleSheet)e.styleSheet.cssText=d(t,r);else{var s=document.createTextNode(r),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(s,o[t]):e.appendChild(s)}}function g(e,t,i){var n=i.css,r=i.media,s=i.sourceMap;if(r?e.setAttribute("media",r):e.removeAttribute("media"),s&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}var h=null,p=0;function w(e,t){var i,n,r;if(t.singleton){var s=p++;i=h||(h=c(t)),n=u.bind(null,i,s,!1),r=u.bind(null,i,s,!0)}else i=c(t),n=g.bind(null,i,t),r=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(i)};return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else r()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n));var i=a(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var n=0;n<i.length;n++){var r=o(i[n]);s[r].references--}for(var c=a(e,t),l=0;l<i.length;l++){var d=o(i[l]);0===s[d].references&&(s[d].updater(),s.splice(d,1))}i=c}}}},480:()=>{}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={id:n,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nc=void 0,i(666),i(823),i(752),i(362)})();